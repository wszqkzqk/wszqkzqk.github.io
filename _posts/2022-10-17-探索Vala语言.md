---
layout:     post
title:      æ¢ç´¢Valaè¯­è¨€
subtitle:   Valaè¯­è¨€å­¦ä¹ å¿ƒå¾—
date:       2022-10-17
author:     æ˜Ÿå¤–ä¹‹ç¥
header-img: img/Vala_Logo.webp
catalog:    true
tags:       GTK Vala å¼€æºè½¯ä»¶
---

***æœªç»ç‰¹æ®Šè¯´æ˜ï¼Œæœ¬æ–‡ä¸­çš„æ‰€æœ‰ä»£ç å‡é‡‡ç”¨[LGPL v2.1+](https://www.gnu.org/licenses/old-licenses/lgpl-2.1.en.html)åè®®å…¬å¼€***

## ç®€ä»‹

Valaè¯­è¨€æ˜¯ä¸€é—¨ä¸“é—¨ä¸ºGObjectå¯¹è±¡è®¾è®¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œè¯­æ³•ç±»ä¼¼äºC#ã€‚Valaå¹¶æ²¡æœ‰è‡ªå·±çš„è¿è¡Œæ—¶ï¼Œè€Œæ˜¯åœ¨ç¼–è¯‘æ—¶ç”±Valaç¼–è¯‘å™¨å°†Valaæºä»£ç è½¬åŒ–ä¸ºCæºä»£ç ï¼Œä»…ä»…ä¾èµ–Cè¯­è¨€çš„åŸºæœ¬ç‰¹æ€§ï¼Œå®ç°äº†ç°ä»£è¯­è¨€çš„ç±»å‹æ¨æ–­ã€`lambda`ã€`class`ç­‰å„ç§é«˜çº§åŠŸèƒ½ã€‚é€šå¸¸æ¥è¯´ï¼ŒåŸºç¡€çš„Valaç¨‹åºçš„ä¾èµ–ä»…æœ‰GLibå’Œç³»ç»Ÿçš„Cè¯­è¨€åº“ï¼Œååˆ†å°å·§ç²¾ç‚¼ã€‚Valaè¿˜å…·æœ‰è‡ªåŠ¨çš„å†…å­˜ç®¡ç†åŠŸèƒ½ï¼Œå®ƒåœ¨ç¼–è¯‘æ—¶è¿›è¡Œå¼•ç”¨è®¡æ•°ï¼Œç”Ÿæˆçš„Cä»£ç ä¸æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„Cä»£ç ç»“æ„ä¸Šç±»ä¼¼ï¼Œé¿å…äº†å¼•å…¥GCæˆ–è¿›è¡Œè¿è¡Œæ—¶å¼•ç”¨è®¡æ•°æ£€æŸ¥å¯¹ç¨‹åºæ•ˆç‡çš„é¢å¤–å¼€é”€ã€‚å› æ­¤ï¼ŒValaåŒæ—¶æ‹¥æœ‰C#çš„é«˜å¼€å‘æ•ˆç‡ä¸Cè¯­è¨€çš„é«˜è¿è¡Œæ•ˆç‡å’Œä½å†…å­˜å ç”¨ã€‚

æ­¤å¤–ï¼ŒValaè¯­è¨€è¿˜å…·æœ‰è·¨å¹³å°çš„ç‰¹æ€§ã€‚ValaèƒŒé å®Œå¤‡çš„åŸºç¡€åº“GLibï¼Œå¼ºå¤§çš„å›¾å½¢åº“GTKï¼Œé«˜åº¦é›†æˆçš„åª’ä½“åº“GStreamerï¼Œä»¥åŠSDL2ã€ZLibã€OpenGLç­‰å„ç§å„æ ·çš„éGNOMEåº“è¯­è¨€ç»‘å®šï¼Œè¿˜å¯ä»¥é€šè¿‡vapiè¿›ä¸€æ­¥æ‹“å±•ã€‚Valaæ—¢èƒ½ç”¨æ¥å¼€å‘é«˜æ•ˆç‡è¿è¡Œçš„CLIåº”ç”¨ï¼Œåˆèƒ½ç”¨æ¥å¼€å‘åŠŸèƒ½ä¸°å¯Œçš„GUIåº”ç”¨ï¼Œé€‚ç”¨åœºæ™¯è¾ƒå¹¿ã€‚

é™„ä¸Šä¸Valaç›¸å…³çš„é‡è¦ç½‘ç«™ï¼š
* [**Vala Programming Language**](https://vala.dev/)
  * Valaè¯­è¨€å®˜ç½‘ï¼ŒåŒ…å«Valaè¯­è¨€çš„å‘å¸ƒä¿¡æ¯ä¸åŸºæœ¬ä»‹ç»
* [**Valadoc.org**](https://valadoc.org/)
  * Valaæ–‡æ¡£ç½‘ç«™ï¼ŒåŒ…å«äº†ValaåŠValaçš„è¯­è¨€ç»‘å®šåº“çš„å¤§é‡æ–‡æ¡£ï¼Œå¯¹å¼€å‘ä¸å­¦ä¹ å¾ˆæœ‰å¸®åŠ©
* [**GNOME: Projects/Vala/Documentation**](https://wiki.gnome.org/Projects/Vala/Documentation)
  * GNOMEå®˜æ–¹å¯¹Valaæ–‡æ¡£çš„æ±‡æ€»
* [**GNOME: Projects/Vala/Tutorial**](https://wiki.gnome.org/Projects/Vala/Tutorial)
  * GNOMEå®˜æ–¹çš„Valaæ•™ç¨‹
* [**Vala Reference Manual**](https://www.vala-project.org/doc/vala/)
  * GNOMEå®˜æ–¹çš„Valaè¯­è¨€å‚è€ƒæ‰‹å†Œ
* [**Introducing Vala Programming**](https://link.springer.com/book/10.1007/978-1-4842-5380-9)
  * å®ä½“ä¹¦ï¼ŒValaç¼–ç¨‹ä»‹ç»
* [**elementary OS: Developer Docs**](https://docs.elementary.io/develop/)
  * elementary OSçš„å¼€å‘æ–‡æ¡£
* [**Meson With Vala**](https://mesonbuild.com/Vala.html)
  * ä½¿ç”¨Mesonæ„å»ºç³»ç»Ÿç»„ç»‡æ„å»ºValaç¨‹åº
* [**Vala for C# Programmers**](https://wiki.gnome.org/Projects/Vala/ValaForCSharpProgrammers)
  * é¢å‘C#ç¨‹åºå‘˜çš„Valaæ•™ç¨‹
* [**Vala for Java Programmers**](https://wiki.gnome.org/Projects/Vala/ValaForJavaProgrammers)
  * é¢å‘Javaç¨‹åºå‘˜çš„Valaæ•™ç¨‹
* [**The GTK project**](https://www.gtk.org/)
  * GTKè®¡åˆ’å®˜ç½‘ï¼Œå†…å«GTKç›¸å…³ä¿¡æ¯ã€èµ„æºã€æ–‡æ¡£ï¼Œä¹ŸåŒ…å«GTKçš„Valaè¯­è¨€ç»‘å®šçš„ç›¸å…³å†…å®¹
* [**GTK Documentation**](https://docs.gtk.org/)
  * GTKæ–‡æ¡£ç½‘ç«™ï¼Œå†…å«GTKç›¸å…³çš„Cè¯­è¨€æ–‡æ¡£ï¼Œå¯ä¾›Valaè¯­è¨€å¼€å‘å‚è€ƒ

## ä¼˜åŠ¿

### è¯­æ³•

Valaè¯­æ³•ä¸C#éå¸¸ç±»ä¼¼ï¼Œç”±äºValaè¯­è¨€ç›¸å¯¹è€Œè¨€ä¸é‚£ä¹ˆå¤§ä¼—ï¼Œå¾ˆå¤šæ—¶å€™å­¦ä¹ Valaè¯­æ³•å¯ä»¥ç›´æ¥å‚è€ƒC#çš„èµ„æ–™ã€‚

ç¬”è€…åœ¨è¿™é‡Œåˆ—å‡ºäº†ä¸€äº›Valaä»£ç è¯­æ³•çš„ç‰¹åˆ«ä¹‹å¤„ï¼Œç®€è¦ç¤ºå‡ºValaè¯­è¨€çš„ä¼˜åŠ¿ã€‚

#### å˜é‡ç±»å‹å‘½å

Valaå¯¹æ•´æ•°å˜é‡ç±»å‹çš„å‘½åè¾ƒä¸ºç®€æ´ï¼Œæ²¡æœ‰ä½¿ç”¨å•°å—¦å†—é•¿çš„`unsigned long long`è¿™æ ·çš„å½¢å¼ã€‚Valaä¸­`char`ã€`int`ã€`long`ç­‰æ‹¼å†™ç®€å•çš„ç±»å‹åä»ç„¶ä¸å˜ï¼Œä½†æ˜¯å¯¹ä¸¤ä¸ªå•è¯åŠä»¥ä¸Šçš„ç±»å‹åè¿›è¡Œäº†è°ƒæ•´ï¼Œä»…ç®€å•æŒ‡å‡ºå…¶ç¬¦å·ä¸ä½æ•°æ¥è¡¨ç¤ºï¼Œå¦‚ï¼šæ²¡æœ‰`usigned int`ï¼Œè€Œæ˜¯ä½¿ç”¨`uint`ï¼›æ²¡æœ‰`long long`ï¼Œè€Œæ˜¯ä½¿ç”¨`int64`ï¼›æ²¡æœ‰`usigned long long`ï¼Œè€Œæ˜¯ä½¿ç”¨`uint64`ã€‚è¿™ä½¿å¾—ä»£ç æ›´åŠ ç®€æ´ï¼Œæ—¢æ–¹ä¾¿ç¼–å†™ï¼Œåˆæ–¹ä¾¿é˜…è¯»ã€‚

æ­¤å¤–ï¼ŒValaç»™å„ç§é•¿åº¦çš„æ•´æ•°éƒ½ç»™å‡ºäº†è·¨å¹³å°çš„ä¿è¯ä½æ•°çš„å®ç°ï¼Œä¾‹å¦‚ï¼š`long`åœ¨64ä½Linuxä¸‹ä¸º64ä½ï¼Œä½†åœ¨64ä½Windowsä¸‹ä¸º32ä½ï¼Œè¿™æ—¶å¦‚æœæœ‰å¿…è¦å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¿è¯é•¿åº¦çš„`int64`æˆ–`int32`å®ç°ã€‚

#### åŒ¿åå‡½æ•°lambda

Valaçš„`lambda`åŒ¿åå‡½æ•°è¯­æ³•ç‰¹åˆ«ç®€æ´ï¼ŒåŸºæœ¬ç»“æ„ä¸º`params => body`ï¼Œå…·ä½“å½¢å¼å¦‚ä¸‹ï¼š
```vala
([arg1], [arg2], [...]) => statement
([arg1], [arg2], [...]) => {block}
```

å‰é¢çš„å°æ‹¬å·å†…ä¼ é€’å‚æ•°ï¼Œä¸éœ€è¦å£°æ˜ç±»å‹ã€‚åé¢çš„è¯­å¥ç›´æ¥ç»™å‡ºå‡½æ•°å†…å®¹ï¼ŒåŒæ ·ä¸éœ€è¦å£°æ˜è¿”å›å€¼çš„ç±»å‹ã€‚

Valaçš„`lambda`åŒ¿åå‡½æ•°ä½¿ç”¨ä¾¿æ·ï¼ŒåŠŸèƒ½ä¹Ÿæ¯”Pythonä¸­ä»…ç›¸å½“äº`return`è¯­å¥çš„`lambda`å‡½æ•°æ›´å¼ºå¤§ã€‚åœ¨å¾ˆå¤šä¼ å‚æ—¶éœ€è¦ç»™å‡ºä¸€ä¸ªå‡½æ•°çš„åœ°æ–¹ï¼ˆä¾‹å¦‚ä¿¡å·çš„`connect`ï¼‰ä½¿ç”¨ç‰¹åˆ«æ–¹ä¾¿ã€‚

#### `main`å‡½æ•°çš„çµæ´»æ€§

C#è¦æ±‚å°†`Main`å‡½æ•°ç½®äºä¸€ä¸ª`class`å†…ï¼Œè€ŒValaçš„`main`å‡½æ•°æ—¢å¯ä»¥åœ¨`class`å†…ï¼Œåˆå¯ä»¥åœ¨`class`å¤–ï¼Œå¿…è¦æ—¶å°†Valaå½“ä½œæ˜¯ç®€åŒ–çš„Cè¯­è¨€æ¥ç”¨ä¹Ÿæœªå°ä¸å¯ã€‚

#### æŒ‡é’ˆé€‚åº¦ä½¿ç”¨

ç”±äºValaè¯­è¨€å…·æœ‰è‡ªåŠ¨å†…å­˜ç®¡ç†åŠŸèƒ½ï¼Œä¸€èˆ¬ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†æŒ‡é’ˆï¼Œä¾‹å¦‚ï¼Œä¸C++å¯¹æ¯”ï¼ŒValaçš„`foreach`å¾ªç¯ä¸éœ€è¦æ‰‹åŠ¨åŒ…å«å–åœ°å€çš„æ“ä½œï¼š
```vala
void main () {
    int[] nums = {1, 2, 3, 4, 5};
    foreach (var i in nums) {
        print ("%d\n", i);
    }
    // Output:
    // 1
    // 2
    // 3
    // 4
    // 5
}
```

Valaçš„ä¸­çš„`List`ç­‰å®¹å™¨ä¹Ÿä¸éœ€è¦æ‰‹åŠ¨æŒ‡é’ˆæ¸…ç†ï¼Œåœ¨ç¦»å¼€å…¶æœ‰æ•ˆè¯­æ®µæˆ–æ‰‹åŠ¨å°†å…¶èµ‹å€¼ä¸º`null`åå³å¯è‡ªåŠ¨é‡Šæ”¾ã€‚

åŒæ—¶ï¼ŒValaåˆä¸C#ä¸åŒï¼ŒValaä»å¯ä»¥æ‰‹åŠ¨åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨æŒ‡é’ˆï¼Œä¸éœ€è¦ç‰¹åˆ«åŒ…æ‹¬åœ¨`unsafe{}`è¯­æ®µä¸­ï¼Œä¾‹å¦‚ï¼š
```vala
uint int64_hash (double? v) {
    return (uint) (((*(uint64*) v >> 32)) ^ (*(uint64*) v & 0xffffffff));
}
```

è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°çš„hashå‡½æ•°ï¼Œä¸ºäº†é¿å…å°†æµ®ç‚¹ç›´æ¥è½¬åŒ–ä¸ºæ•´æ•°æ—¶å¯¼è‡´çš„æº¢å‡ºæˆ–æ•´æ•°éƒ¨åˆ†ç›¸åŒæ—¶çš„å‰§çƒˆhashç¢°æ’ç­‰ç§ç§é—®é¢˜ï¼Œæ­¤å¤„å°†doubleçš„å‰32ä½ä¸å32ä½å–å¼‚æˆ–ï¼Œå¾—åˆ°hashå€¼ã€‚è¿™ä¸€è¿‡ç¨‹éœ€è¦åœ¨å­˜å‚¨doubleçš„å†…å­˜ç©ºé—´ä¸­å–å‡ºä¸¤ä¸ªæ•´æ•°ï¼Œä¸å¯é¿å…åœ°éœ€è¦ä½¿ç”¨æŒ‡é’ˆã€‚

ä½†å³ä½¿å¦‚æ­¤ï¼Œç”±äºéœ€è¦æŒ‡é’ˆçš„å¸¸è§æ•°æ®ç»“æ„åœ¨Valaçš„æ ‡å‡†åº“GLibä»¥åŠå®¹å™¨åº“Geeä¸­å·²æœ‰è¾ƒä¸ºå®Œå¤‡çš„å®ç°ï¼ŒValaä¸­æå°‘éœ€è¦æ‰‹åŠ¨ä½¿ç”¨æŒ‡é’ˆï¼ŒValaå®˜æ–¹ä¹Ÿå»ºè®®è°¨æ…æ‰‹åŠ¨ä½¿ç”¨ã€‚

#### è¯­æ³•ç³–è®¾è®¡

Valaä¸­è¿˜æœ‰å¾ˆå¤šçš„è¯­æ³•ç³–ï¼Œå¯ä»¥ç®€åŒ–è¯­å¥å¹¶æé«˜å¼€å‘æ•ˆç‡ã€‚ä¾‹å¦‚ï¼š
```vala
void main () {
    var map = new Gee.HashMap<string, int> ();

    map.set ("one", 1);
    map["two"] = 2;             // The same as map.set ("two", 2)

    var a = map.get ("one");
    var b = map["two"];        // The same as map.get ("two")

    if (map.has_key ("one")) {
        print ("\"one\" is in map.keys");
    }

    if ("two" in map.keys) {         // The same as map.has_key ("two")
        print ("\"two\" is in map.keys");
    }
}
```

### å…¥é—¨æ›²çº¿

ç¬”è€…è®¤ä¸ºValaè¯­è¨€çš„å­¦ä¹ æ›²çº¿æ˜æ˜¾è¾ƒCæˆ–è€…C++å¹³ç¼“ã€‚ä¸€æ–¹é¢ï¼ŒValaçš„è¯­æ³•è¾ƒCä¸C++ç®€å•ï¼Œæ˜“äºä¸Šæ‰‹ï¼›å¦ä¸€æ–¹é¢ï¼ŒValaå…·æœ‰è‡ªåŠ¨åŒ–çš„å†…å­˜ç®¡ç†åŠŸèƒ½ï¼Œä¸ç”¨æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œç”šè‡³ç”±äºGLibä¸Geeå†…ç½®çš„æ•°æ®ç»“æ„æå…¶ä¸°å¯Œï¼Œä¹ŸåŸºæœ¬ä¸Šå¯ä»¥ä¸ç”¨æŒ‡é’ˆã€‚Valaè¿˜ä¸éœ€è¦Cæˆ–è€…C++é‚£æ ·çš„`include`è¯­å¥ï¼Œå¯¹äºåŸºç¡€çš„ç¼–ç¨‹å†…ç½®çš„GLibåº“å®Œå…¨è¶³å¤Ÿï¼Œä¸éœ€è¦çŸ¥é“è°ƒç”¨å…¶ä»–åº“çš„å‘½ä»¤ï¼Œè¿™å¯¹å…¥é—¨ä¹Ÿååˆ†å‹å¥½ï¼›è€Œæƒ³è¦åœ¨Valaä¸­ä½¿ç”¨å…¶ä»–åº“æ—¶ä¹Ÿååˆ†ç®€å•ï¼Œä¸éœ€è¦ä½¿ç”¨é¢„å¤„ç†è¯­å¥æˆ–è€…å¤æ‚çš„é“¾æ¥å‘½ä»¤ï¼Œåªéœ€è¦åœ¨ç¼–è¯‘å‚æ•°æˆ–è€…Unix Shebangä¸­ç”¨`--pkg=xxx-x.x`æŒ‡æ˜æ‰€éœ€è¦çš„åº“å³å¯ã€‚æ­¤å¤–ï¼Œç”±äºValaæœ‰å¼ºå¤§çš„æ ‡å‡†åº“ï¼Œå¾ˆå¤šåœ¨Cæˆ–è€…C++ä¸­éœ€è¦è‡ªå·±æ…¢æ…¢å®ç°çš„å‡½æ•°æˆ–åŠŸèƒ½åœ¨GLibåº“ä¸­å·²æœ‰é›†æˆï¼ŒåŒæ ·ä¹Ÿé™ä½äº†åˆå­¦è€…çš„å­¦ä¹ è´Ÿæ‹…ã€‚

äº‹å®ä¸Šï¼Œç¬”è€…è™½ç„¶è‡ªåˆä¸­ä»¥æ¥ä¸€ç›´éƒ½æœ‰å­¦ä¹ Valaçš„æƒ³æ³•ï¼Œä½†ä¸€ç›´æ²¡æœ‰çœŸæ­£å»å°è¯•ï¼Œç›´åˆ°åœ¨å­¦äº†Pythonä»¥åè‡ªå­¦C/C++å—é˜»ï¼ˆåªä¼šPythonçš„èœé¸¡åˆšåˆšæ¥è§¦è¿™æ ·è¾ƒåº•å±‚çš„è¯­è¨€ï¼Œå†åŠ ä¸Šæ˜¯è¾ƒæ··ä¹±çš„è‡ªå­¦ï¼Œæ²¡æœ‰å¤´ç»ªï¼Œå½“æ—¶ç¡®å®æ„Ÿè§‰æœ‰ç‚¹å›°éš¾ğŸ¤£ğŸ¤£ğŸ¤£ï¼‰ï¼Œæ‰é‡æ–°æƒ³èµ·Valaè¯­è¨€ï¼Œè¿™æ‰å¼€å§‹å­¦ä¹ Valaã€‚è¿™ä¹Ÿè®¸ä¹Ÿå¯ä»¥ä½œä¸ºValaå­¦ä¹ æ›²çº¿è¾ƒC/C++å¹³ç¼“çš„ä¸€ä¸ªè®ºæ®ğŸ˜‚ã€‚

### æ ‡å‡†åº“ä¸åŠŸèƒ½

Valaçš„è®¾è®¡å³ä¸ºç°ä»£åŒ–çš„é«˜çº§è¯­è¨€ï¼Œæ‹¥æœ‰å¤§é‡ç°ä»£è¯­è¨€çš„åŠŸèƒ½ã€‚æ­¤å¤–ï¼ŒLinuxå¹³å°ä¸‹ä½¿ç”¨æœ€å¹¿æ³›ã€åŠŸèƒ½é›†æˆæœ€ä¸°å¯Œçš„Cè¯­è¨€åº“â€”â€”GLibå¯ä»¥è®¤ä¸ºæ˜¯Valaè¯­è¨€çš„æ ‡å‡†åº“ã€‚GLibå†…ç½®äº†æå…¶ä¸°å¯Œçš„å†…ç½®å‡½æ•°ã€GObjectå¯¹è±¡ã€I/Oé€šé“ã€æ•°æ®ç»“æ„ï¼Œå› æ­¤ï¼ŒValaè¯­è¨€å†…ç½®çš„æ ‡å‡†åº“ä¹Ÿååˆ†å¼ºå¤§ã€‚ä¸‹é¢ç¬”è€…å°†å¯¹ä¸€äº›è‡ªå·±å–œæ¬¢çš„Valaå†…ç½®çš„å¼ºå¤§åŠŸèƒ½è¿›è¡Œç®€è¦ä»‹ç»ã€‚

#### å­—ç¬¦ä¸²å¤„ç†åŠè¾“å…¥è¾“å‡º

ç¬”è€…éå¸¸å–œæ¬¢Valaå¼ºå¤§çš„å­—ç¬¦ä¸²å¤„ç†åŠŸèƒ½ã€‚

Valaæ”¯æŒç›´æ¥ç”¨`+`æ‹¼æ¥å­—ç¬¦ä¸²ï¼š
```vala
void main () {
    var s1 = "123";
    var s2 = "456";
    var s3 = s1 + s2 + "\n";
    print (s3);
    // Output:
    // 123456
}
```

å¯¹äºä¸€èˆ¬çš„å­—ç¬¦ä¸²å¤„ç†ï¼Œé™¤äº†Cè¯­è¨€é£æ ¼çš„`xxx.printf ()`å¤„ç†å¤–ï¼ŒValaè¿˜æ”¯æŒ`@"content"`å½¢å¼çš„æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œåœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­ï¼Œå¯ä»¥ç”¨`$xxx`æˆ–`$(xxx)`æ’å…¥æ‰€éœ€è¦è¾“å‡ºçš„å†…å®¹ï¼Œå¯ä»¥æ˜¯å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¿ç®—è¯­å¥ï¼Œä¾‹å¦‚ï¼š
```vala
void main () {
    int n = 123456;
    uint m = 987654321;
    double pi = 3.141592653589;
    print (@"$m + $n + pi = $(m + n + pi)\n");
    // Output:
    // 987654321 + 123456 + pi = 987777780.14159262
}
```

ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²è¿›è¡Œè¾“å‡ºï¼Œæ—¢ä¸ç”¨åƒCè¯­è¨€é£æ ¼çš„`printf`ä¸€æ ·åœ¨å­—ç¬¦ä¸²ä¸­ç”¨`%`å£°æ˜å˜é‡ç±»å‹ï¼Œåˆä¸ç”¨åƒC++çš„`cout`ä¸€æ ·ç”¨å¾ˆé•¿ä¸€ä¸²`<<`è¿æ¥ã€‚Valaçš„æ¨¡æ¿å­—ç¬¦ä¸²æ˜¯å…ˆå®Œæ•´ç”Ÿæˆï¼Œå†æ•´ä½“è¾“å‡ºï¼Œä¹Ÿé¿å…äº†`cout`çš„çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼Œæ˜¯ä¸€ç§æ–¹ä¾¿åˆä¸ä¹çµæ´»çš„æ–¹æ³•ã€‚å¦å¤–ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²å¯ä»¥åœ¨ç”Ÿæˆåå­˜å‚¨å¾…ç”¨è€Œä¸è¾“å‡ºï¼Œæ•´ä½“æ¥çœ‹æ˜¯ä¸€ç§ä¸Pythonè¯­è¨€çš„`f-string`ååˆ†ç›¸ä¼¼çš„æ–¹æ³•ï¼Œä¾¿äºä½¿ç”¨ï¼ˆä¹Ÿè®¸ç°åœ¨C++çš„`std::print`å’Œ`std::format`ä¹Ÿå·®ä¸å¤šäº†ğŸ¥²ï¼‰ã€‚

å½“ç„¶ï¼ŒValaä¹Ÿæ”¯æŒCè¯­è¨€é£æ ¼çš„printfæ ¼å¼åŒ–ï¼Œæ•ˆæœä¸ä¹‹å‰çš„æ¨¡æ¿å­—ç¬¦ä¸²å®ç°ç±»ä¼¼ï¼Œä½†æ˜¯æ›´åŠ éº»çƒ¦ï¼š
```vala
void main () {
    int n = 123456;
    uint m = 987654321;
    double pi = 3.141592653589;
    print ("%u + %d + pi = %f\n", m, n, pi + m + n);
    // Output:
    // 987654321 + 123456 + pi = 987777780.141593
}
```

Valaçš„æ¨¡æ¿å­—ç¬¦ä¸²ä¸­`$`çš„ä½¿ç”¨ç±»ä¼¼äºUnix Shellçš„å˜é‡å¼•ç”¨ï¼Œç¬¦åˆä¼—å¤šLinuxç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯ï¼ŒåŒæ—¶åŠŸèƒ½å¼ºå¤§ï¼Œå¾ˆå¤šæ—¶å€™æ˜¯ç®€åŒ–è¾“å‡ºä»£ç çš„ä¸€å¤§åˆ©å™¨ã€‚

é™¤æ­¤ä¹‹å¤–ï¼ŒValaè¿˜æ”¯æŒå­—ç¬¦ä¸²åˆ‡ç‰‡ã€å­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„æå–ï¼Œä¾‹å¦‚ï¼š
```vala
void main () {
    var s1 = "abcdefg";
    var s2 = s1[0:3];
    var c = s1[3];
    print (@"$s2\n$c\n");
    // Output:
    // abc
    // d
} 
```

Pythonç¨‹åºå‘˜æ³¨æ„ï¼šè¿™é‡Œæå–çš„å•ä¸ªå­—ç¬¦æ•°æ®ç±»å‹æ˜¯`char`è€Œä¸æ˜¯`string`ï¼Œ`char`åœ¨ä»£ç ä¸­è¡¨ç¤ºæ—¶éœ€è¦ç”¨å•å¼•å·ï¼Œè€Œ`string`éœ€è¦ç”¨åŒå¼•å·ã€‚`char`æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª8ä½æœ‰ç¬¦å·æ•°å­—ï¼Œå¯ä»¥ç›´æ¥ä¸æ•°å­—è¿›è¡Œæ¯”è¾ƒï¼Œä¸éœ€è¦Pythonçš„`ord`å‡½æ•°ã€‚

Valaè¿˜æ”¯æŒé€å­—å­—ç¬¦ä¸²ï¼Œç±»ä¼¼äºPythonçš„`r-string`æˆ–C#çš„`@""`ï¼ˆç„¶è€ŒC#çš„é€å­—å­—ç¬¦ä¸²çš„è¯­æ³•åœ¨Valaä¸­è¡¨ç¤ºå­—ç¬¦ä¸²æ¨¡æ¿ï¼‰ï¼Œå½¢å¦‚`"""xxx"""`ï¼ˆæ³¨æ„ï¼šPythonä¸­ä¹Ÿæœ‰ç±»ä¼¼è¯­æ³•è¡¨è¾¾ï¼Œä½†æ˜¯æ„ä¹‰ä¸ºå¤šè¡Œå­—ç¬¦ä¸²ï¼›Valaè¯­è¨€ä¸Pythonä¸åŒï¼Œä¸ä¾èµ–æ¢è¡Œç¬¦ä½œä¸ºè¯­å¥åˆ†éš”ï¼Œå› æ­¤å„ç§è¡¨è¾¾æ–¹å¼çš„å­—ç¬¦ä¸²éƒ½èƒ½è·¨è¡Œï¼Œè¿™é‡Œçš„`"""xxx"""`è¿˜ç‰¹åˆ«è¡¨ç¤ºäº†é€å­—å­—ç¬¦ä¸²ï¼‰

Valaçš„æ–‡å­—è¾“å…¥ä¹Ÿè¾ƒä¸ºæ–¹ä¾¿ã€‚Valaé™¤äº†å¯ä»¥ä½¿ç”¨Cè¯­è¨€é£æ ¼çš„`getc`ã€`scanf`ç­‰å¤–ï¼Œè¿˜æœ‰`read_line`å‡½æ•°å¯ä»¥è¯»å–ä¸€æ•´è¡Œçš„å†…å®¹ï¼Œæ³¨æ„ä½¿ç”¨æ—¶æ˜¯é€šè¿‡`FileStream`å¯¹è±¡ä¸‹çš„æ–¹æ³•æ¥è¿›è¡Œçš„ï¼ˆ`getc`ã€`scanf`å‡½æ•°ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ï¼Œå¦‚æœè¦ä»æ ‡å‡†è¾“å…¥æµè¯»å–ï¼Œå³ä½¿ç”¨`stdin.read_line()`ï¼š
```vala
void main () {
    var s = stdin.read_line ();
    print (@"Your input is: $s\n");
    // Output:
    // Your output is: xxx(your input)
}
```

è¿™ä¸€å‡½æ•°åŠŸèƒ½ä¸Šç±»ä¼¼äºPythonç­‰è¯­è¨€çš„`input`ï¼Œå¯¹ç†Ÿæ‚‰Pythonçš„äººæ¥è¯´æ¯”è¾ƒæ–¹ä¾¿ã€‚

ç”±äºValaèƒŒé å¼ºå¤§çš„GLibåº“ï¼Œå¯¹å­—ç¬¦ä¸²çš„é«˜çº§å¤„ç†ä¹Ÿæœ‰å¾ˆå¥½çš„æ”¯æŒã€‚è¯¸å¦‚`split`ã€`replace`ã€`has_prefix`ã€`has_suffix`ã€`ascii_down`ã€`ascii_up`ã€`strip`ç­‰è¾ƒé«˜çº§çš„å¤„ç†å‡½æ•°åœ¨å†…ç½®çš„`string`å¯¹è±¡ä¸­å‡æœ‰å®ç°ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°å­—ç¬¦ä¸²çš„é«˜çº§å¤„ç†ã€‚ä»¥ä¸‹æ˜¯ç¤ºä¾‹ï¼š
```vala
void main () {
    var s1 = "Hello, beautiful but dangerous world!";
    var tab = s1.split (" ");
    print ("%s\n%s\n", tab[0], tab[4]);
    // Output:
    // Hello,
    // World!

    var s2 = s1.ascii_up ();
    print ("%s\n", s2);
    // Output:
    // HELLO, BEAUTIFUL BUT DANGEROUS WORLD!

    var s3 = s1.replace ("beautiful but dangerous", "wonderful");
    print ("%s\n", s3);
    // Output:
    // Hello, wonderful world!

    var s4 = s1.reverse ();
    print ("%s\n", s4);
    // Output:
    // !dlrow suoregnad tub lufituaeb ,olleH

    var s5 = "  \t  Hello, world!  \t\t ";
    var s6 = s5.strip ();
    print ("%s\n", s6);
    // Output:  
    // Hello, world!

    var pre = "Hell";
    if (s6.has_prefix (pre)) {
        print (@"\"$pre\" is the prefix of \"$s6\"\n");
    }
    // Output:  
    // "Hell" is the prefix of "Hello, world!"
}
```

Pythonç¨‹åºå‘˜éœ€è¦æ³¨æ„ï¼ŒValaä¸­çš„`split`å¿…é¡»è¦æ‰‹åŠ¨æŒ‡å®šåˆ†éš”ç¬¦ï¼Œå½“åˆ†éš”ç¬¦æŒ‡å®šä¸ºé€šå¸¸çš„ç©ºæ ¼æ—¶ï¼Œè¡Œä¸ºå°†ä¸Pythonä¸­é»˜è®¤çš„æ— å‚`split()`ä¸åŒï¼ŒæŒ‡å®šäº†`split(" ")`æ—¶ï¼Œæ— è®ºæ˜¯åœ¨Pythonä¸­è¿˜æ˜¯åœ¨Valaä¸­ï¼Œå¤šä¸ªè¿ç»­ç©ºæ ¼é—´å°†ä¼šåˆ†éš”å‡ºç©ºå­—ç¬¦ä¸²ï¼Œè€Œæ— å‚çš„`split()`åˆ™æ²¡æœ‰ï¼š
```python
tab = "1    2".split()
```

è¿™æ ·å¾—åˆ°çš„`tab`å†…å®¹ä¸º`["1", "2"]`ã€‚è€Œå¯¹äºValaï¼š
```vala
var tab = "1    2".split (" ");
```

è¿™æ ·å¾—åˆ°çš„`tab`å†…å®¹ä¸º`{"1", "", "", "", "2"}`ã€‚æœ‰æ—¶å¿˜è®°å¤„ç†ç©ºå­—ç¬¦ä¸²ä¼šå¼•å‘æŸäº›bugã€‚

#### æ­£åˆ™è¡¨è¾¾å¼

Valaå†…ç½®é›†æˆäº†å¼ºå¤§çš„æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥å°†ä¸€èˆ¬çš„å­—ç¬¦ä¸²å½¢å¼çš„æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ã€‚æ­£åˆ™è¡¨è¾¾å¼åœ¨Valaä¸­ä¸è¯­è¨€çš„é›†æˆåº¦é«˜ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼š
```vala
void main () {
    var msys2_dep_regex = new Regex (""".*(/|\\)(usr|ucrt64|mingw64|clang64|mingw32|clang32|clangarm64)(/|\\)""");
    var path = "D:\\msys64\\ucrt64\\bin\\libglib-2.0-0.dll";
    MatchInfo match_info;

    if (msys2_dep_regex.match (path, 0, out match_info)) {
        print (@"This file is in msys2 environment \"$(match_info.fetch(0))\".\n");
    } else {
        print ("This file doesn't in msys2 environment.\n");
    }
    // Output:
    // This file is in msys2 environment "D:\msys64\ucrt64\".
}
```

Valaè¯­è¨€è¿˜å¯ä»¥åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨è¯†åˆ«æ­£åˆ™è¡¨è¾¾å¼å†…å®¹ï¼Œä¸ç”¨æ‰‹åŠ¨ä»å­—ç¬¦ä¸²æ–°å»ºï¼š
```vala
Regex quote_regex = /(".*")|('.*')/;
var msys2_dep_regex = /.*(\/|\\)(usr|ucrt64|clang64|mingw64|mingw32|clang32|clangarm64)(\/|\\)/;
```

ç›´æ¥çš„æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ä¸ä»…ç®€åŒ–äº†è¯­æ³•ï¼Œè€Œä¸”Valaä¼šåœ¨ç¼–è¯‘æ—¶çš„æ—¶å€™æ£€æŸ¥æ­£åˆ™è¡¨è¾¾å¼çš„æ­£ç¡®æ€§ï¼ˆLSPä¹Ÿä¼šåœ¨IDEä¸­æŒ‡å‡ºé”™è¯¯ï¼‰ï¼Œä¾¿äºåŠæ—©å‘ç°æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„é”™è¯¯ï¼Œé¿å…äººä¸ºçš„ç–å¿½è¿›å…¥ç¨‹åºä¸­ï¼Œå¢åŠ äº†ç¨‹åºçš„ç¨³å¥æ€§ã€‚

### Vala Scriptsä¸Unix Shebang

Valaè¯­è¨€æ”¯æŒå°†æºä»£ç **ç¬¬ä¸€è¡Œ**å†™ä¸ºUnix Shebangçš„å½¢å¼ï¼š
```vala
#!/usr/bin/env vala
```

èµ‹äºˆè¯¥æºä»£ç æ–‡ä»¶å¯æ‰§è¡Œæƒé™åå³å¯ç›´æ¥æ‰§è¡Œè¯¥æœªç»ç¼–è¯‘çš„æºä»£ç ã€‚åœ¨æ‰§è¡Œæ—¶ï¼Œç³»ç»Ÿå…ˆä¼šè‡ªåŠ¨è°ƒç”¨`vala`å‘½ä»¤ï¼ˆä¸æ˜¯ä¸€èˆ¬ç¼–è¯‘æ—¶ç”¨çš„`valac`å‘½ä»¤ï¼‰å¯¹ä»£ç æ–‡ä»¶è¿›è¡ŒAOTç¼–è¯‘ï¼Œç„¶åå†è‡ªåŠ¨æ‰§è¡Œç¼–è¯‘å¾—åˆ°çš„æ–‡ä»¶ï¼Œæ•´ä½“ä¸Šèµ·åˆ°äº†ç±»ä¼¼è„šæœ¬çš„æ•ˆæœã€‚å› æ­¤ç®€å•Valaçš„ç¨‹åºçš„è°ƒè¯•ååˆ†æ–¹ä¾¿ï¼Œå…å»äº†æ‰‹åŠ¨ç¼–è¯‘çš„éº»çƒ¦ã€‚è¿™ä¸€ç‰¹æ€§ä¹Ÿä½¿å¾—Valaå¯ä»¥å½“ä½œè„šæœ¬è¯­è¨€ï¼ˆå³Vala Sciptsï¼‰åœ¨ç±»Unixç³»ç»Ÿä¸‹ä½¿ç”¨ã€‚ç”±äºåœ¨Linuxä¸‹valacä¸gccç¼–è¯‘è€—æ—¶éƒ½è¾ƒçŸ­ï¼ŒVala Scriptå¯åŠ¨å»¶è¿Ÿä½ï¼Œè€Œä¸”è¿è¡Œçš„æ˜¯ç¼–è¯‘å¥½çš„æœ¬æœºäºŒè¿›åˆ¶æœºå™¨ç ï¼Œæ²¡æœ‰JITæˆ–è§£é‡Šå™¨çš„æ€§èƒ½å¼€é”€ï¼Œè¿è¡Œæ•ˆç‡é«˜ï¼Œè¿è¡Œæ•ˆç‡é«˜ï¼Œæœ‰ç€ä¸é”™çš„ä½“éªŒã€‚

å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨Shebangä¸­å‘ç¼–è¯‘å™¨æ­£å¸¸ä¼ å…¥å‚æ•°ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥å¼€å¯ç¼–è¯‘å™¨ä¼˜åŒ–ï¼š
```vala
#!/usr/bin/env -S vala -X -O2 -X -march=native -X -pipe
```

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯`env`çš„ç‰¹æ€§ï¼šéœ€è¦ä¼ é€’`-S`å‚æ•°è¡¨ç¤ºåé¢çš„å‘½ä»¤æŒ‰ç…§ç©ºæ ¼åˆ†éš”ã€‚ä¼ ç»™Valaç¼–è¯‘å™¨çš„å‘½ä»¤ä¸­ï¼Œ`-X`åæ‰€ç´§è·Ÿçš„å†…å®¹ä¼šç›´æ¥ä¼ é€’ç»™gccç¼–è¯‘å™¨ï¼Œè¿™é‡Œçš„`-O2`è¡¨ç¤ºæŒ‰ç…§`O2`ç­‰çº§å¯ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œ`-march=native`è¡¨ç¤ºåˆç†ã€å……åˆ†åˆ©ç”¨æœ¬æœºæ”¯æŒçš„æ‰€æœ‰æŒ‡ä»¤é›†ï¼Œ`-pipe`è¡¨ç¤ºè®©gccç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶ç›´æ¥é€šè¿‡ç®¡é“ä¼ é€’ï¼Œä¸å†™å…¥ç¡¬ç›˜ã€‚è¿™ä¸‰ä¸ªé€‰é¡¹å‡æ˜¯ç”¨æ¥åŠ å¿«è¿è¡Œé€Ÿåº¦æˆ–è€…ç¼–è¯‘é€Ÿåº¦çš„ã€‚

ç”±äºVala Scriptsè¿è¡Œçš„æ—¶å€™å­˜åœ¨è‡ªåŠ¨ç¼–è¯‘çš„è¿‡ç¨‹ï¼Œå¦‚æœå®‰è£…äº†æŸäº›èƒ½å¤ŸåŠ é€Ÿç¼–è¯‘çš„è½¯ä»¶ï¼Œå¯ä»¥åŠ å…¥è°ƒç”¨çš„å‘½ä»¤å‚æ•°ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸€å®šç¨‹åº¦ä¸Šå‡å°ç¨‹åºå¯åŠ¨å»¶è¿Ÿçš„æ•ˆæœï¼š
```vala
#!/usr/bin/env -S vala -X -O2 -X -march=native --cc="ccache gcc" -X -fuse-ld=mold -X -pipe
```

ä»¥ä¸Šçš„Shebangå‚æ•°è°ƒç”¨äº†`ccache`è¿›è¡Œç¼–è¯‘ç¼“å­˜åŠ é€Ÿï¼Œå¹¶ä½¿ç”¨äº†å…ˆè¿›ã€é«˜æ•ˆçš„`mold`é“¾æ¥å™¨è¿›è¡Œé“¾æ¥ï¼Œå¯ä»¥åŠ å¿«ç¼–è¯‘é€Ÿç‡ã€‚å½“ç„¶ï¼Œè¿™éœ€è¦æå‰å®‰è£…å¥½æ‰€éœ€è¦çš„`mold`å’Œ`ccache`æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚

æˆ‘ä»¬è¿˜å¯ä»¥åœ¨Shebangä¸­ä¸ºValaç¼–è¯‘å™¨æŒ‡å®šæ‰€éœ€è¦è°ƒç”¨çš„åº“ï¼Œä¾‹å¦‚ï¼š
```vala
#!/usr/bin/env -S vala --pkg=gee-0.8 --pkg=gio-2.0 --pkg=gtk+-3.0
```

è¿™ä»£è¡¨ä»¤Valaç¼–è¯‘å™¨å¯»æ‰¾å¹¶è°ƒç”¨`gee`ã€`gio`ã€`gtk+-3.0`è¿™3ä¸ªåº“ã€‚åŒæ—¶ï¼Œè¿™æ ·çš„è¯­å¥ä¹Ÿå¯ä»¥è¢«LSPè¯†åˆ«ï¼Œä»¤LSPèƒ½å¤Ÿç†è§£æ‰€è°ƒç”¨çš„åº“ä¸­åŒ…å«çš„å†…å®¹ã€‚

***æ³¨æ„ï¼šè¿™ä¸€åŠŸèƒ½è™½ç„¶å¼ºå¤§ï¼Œä½†æ¯•ç«Ÿä¸Unixç‰¹æ€§é«˜åº¦ç›¸å…³ï¼Œä»…åœ¨ç±»Unixå¹³å°ä¸‹å¯ç”¨ï¼ŒWindowsä¸‹æ— æ³•ç›´æ¥æ‰§è¡Œå¸¦æœ‰Shebangçš„æ–‡ä»¶ï¼Œä»…å¯ç”¨äºLSPè¯†åˆ«***

å½“ç„¶ï¼Œä½œä¸º"Scripts"çš„ç±»ä¼¼ç‰©ï¼ŒValaè¿˜å®éªŒæ€§æ”¯æŒé¡¶çº§è¯­å¥åŠŸèƒ½ï¼Œå³ï¼Œåƒè„šæœ¬è¯­è¨€ä¸€æ ·ç”Ÿæˆè¯¥ç¨‹åºï¼Œä¸ç”¨å°†ç¨‹åºå…¥å£ç‚¹æ”¾åœ¨`main ()`å‡½æ•°ä¸­ï¼š
```vala
#!/usr/bin/env -S vala -X -O2 -X -march=native -X -pipe

var a = 123;
var b = 456;
print (@"$a plus $b is $(a+b)");
```

ä»¥ä¸ŠValaä»£ç è™½ç„¶æ²¡æœ‰`main`å‡½æ•°ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ­£å¸¸ç¼–è¯‘è¿è¡Œï¼Œæˆ–è€…åœ¨Unixä¸‹æˆäºˆå¯æ‰§è¡Œæƒé™æ‰§è¡Œç›´æ¥æ‰§è¡Œã€‚ç¨‹åºä¼šå°†é¡¶çº§è¯­æ®µè§†ä½œç¨‹åºå…¥å£ç‚¹æ­£å¸¸å¤„ç†ã€‚

è¿™äº›ç‰¹æ€§ä½¿å¾—Valaè™½ç„¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªé™æ€ç¼–è¯‘çš„è¯­è¨€ï¼Œä½†ä¹Ÿæœ‰ç€ä¸€äº›è´´è¿‘è„šæœ¬è¯­è¨€çš„æ–¹ä¾¿ç‰¹æ€§ã€‚åŒæ—¶ï¼Œé«˜åº¦ç®€åŒ–çš„è¯­æ³•ä¹Ÿé™ä½äº†æ–°æ‰‹å…¥é—¨çš„é—¨æ§›ã€‚

### IDEä¸LSPæ”¯æŒ

ç›®å‰ï¼ŒGNOME Builderä¸å®‰è£…äº†Valaè¯­è¨€æ’ä»¶çš„VS Codeéƒ½æ˜¯éå¸¸æ˜“ç”¨çš„Valaå¼€å‘ç¯å¢ƒï¼Œå¯¹äºè¾ƒè½»é‡çº§çš„å¼€å‘ï¼ŒKDEçš„é«˜çº§æ–‡æœ¬ç¼–è¾‘å™¨Kateä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ç»“åˆVala language serveræˆ–gvlsçš„LSPåŠŸèƒ½ï¼Œè¿™äº›IDEæˆ–ç¼–è¾‘å™¨æ”¯æŒäº†è¯­æ³•é«˜äº®ã€è‡ªåŠ¨è¡¥å…¨ã€ä»£ç æ ¼å¼åŒ–ã€ä»£ç é™æ€åˆ†æã€å®šä¹‰è·³è½¬ã€æ–‡æ¡£é›†æˆã€è°ƒè¯•æ–­ç‚¹ç­‰å¼ºå¤§åŠŸèƒ½ï¼Œå¢åŠ äº†å¼€å‘æ•ˆç‡ã€‚

## ä¸è¶³

è‡ªValaè¯­è¨€äº2006å¹´æ¨å‡ºåˆ°ç°åœ¨ï¼Œå§‹ç»ˆæ²¡æœ‰èƒ½å¤Ÿå‘å¸ƒæ­£å¼ç‰ˆã€‚è¯¥è¯­è¨€è™½ç„¶å¼€å‘é«˜æ•ˆï¼Œä½¿ç”¨ä¾¿æ·ï¼Œä½†æ˜¯ä½¿ç”¨äººæ•°ä¸å¼€å‘äººæ•°éƒ½è¿œè¿œå°äºä¸»æµå¤§ä¼—è¯­è¨€ã€‚å› æ­¤ï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›ä¸å¤ªå¸¸ç”¨çš„åœ°æ–¹ï¼ŒValaå¯èƒ½ä¼šå­˜åœ¨ä¸€å®šçš„ç¼–è¯‘å™¨Bugã€‚è€Œè¿™äº›ç¼–è¯‘å™¨Bugåœ¨å¼€å‘è¿‡ç¨‹ä¸­å¾€å¾€éš¾ä»¥å®šä½ï¼Œé™ä½å¼€å‘æ•ˆç‡ã€‚Valaè¯­è¨€ä¸»è¦æ˜¯ä¸ºäº†GObjectå¼€å‘ï¼Œè€ŒGObjectç›¸å…³ç¨‹åºåœ¨Linuxä¸‹æœ‰ç€å¾ˆå¹¿æ³›çš„ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨Windowså¹³å°ä¸‹ç”¨å¾—å¹¶ä¸å¤šï¼Œæ‰€ä»¥Valaå¯¹Windowså¹³å°ä¸‹çš„å¼€å‘ä½“éªŒå¯èƒ½é¡¾åŠè¾ƒå°‘ã€‚

ç¬”è€…åœ¨è¿™é‡Œå¯¹è‡ªå·±åœ¨å­¦ä¹ Valaè¿‡ç¨‹ä¸­é‡åˆ°çš„ç¼–è¯‘å™¨Bugæˆ–åäººç±»ä¹‹å¤„ã€ä¸åˆç†ä¹‹å¤„äºˆä»¥åˆ—ä¸¾ã€‚

### åæ–œæ ç¾éš¾ï¼šWindowsä¸‹çš„ç¼–è¯‘å™¨Bugï¼ˆå·²ä¿®å¤ï¼‰

Valaç¨‹åºæ”¯æŒä½¿ç”¨GDBç­‰å·¥å…·è¿›è¡Œè°ƒè¯•ï¼ˆéœ€è¦åœ¨ç¼–è¯‘æ—¶å‘`valac`ç¼–è¯‘å™¨ä¼ é€’`-g`å‚æ•°ï¼‰ã€‚Valaç¼–è¯‘å™¨ä¾é åœ¨ç”Ÿæˆçš„Cæºä»£ç ä¸­æ’å…¥`#line`è¯­å¥æ¥åŠ å…¥ç¨‹åºä¸­å¯¹åº”çš„æºä»£ç æ–‡ä»¶çš„è·¯å¾„ä»¥åŠè¡Œæ•°ç­‰è°ƒè¯•ä¿¡æ¯ã€‚

ç„¶è€Œï¼Œåœ¨ç¬”è€…å°†è¿™ä¸€Bugä¿®å¤å‰ï¼ŒValaä¼šå°†ç¼–è¯‘å‚æ•°ä¸­çš„æ–‡ä»¶è·¯å¾„æœªåŠ å¤„ç†å³å†™å…¥åˆ°ç”Ÿæˆçš„Cæºä»£ç ä¸­ã€‚å¯¹äºLinuxç­‰ç±»Unixå¹³å°ï¼Œæ–‡ä»¶è·¯å¾„çš„åˆ†éš”ç¬¦ä¸º`/`ï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°é—®é¢˜ã€‚ä½†æ˜¯Windowså¹³å°çš„æ–‡ä»¶è·¯å¾„åˆ†éš”ç¬¦ä¸º`\`ï¼ŒCæºä»£ç å­—ç¬¦ä¸²ä¸­çš„`\`å°†ä¼šè¢«è¯†åˆ«ä¸ºè½¬ä¹‰å­—ç¬¦ï¼Œè¿™ä¼šå¯¼è‡´`#line`è¯­å¥ä¸­çš„æºä»£ç æ–‡ä»¶è·¯å¾„é”™è¯¯ï¼Œä½¿å¾—è°ƒè¯•æ— æ³•è¿›è¡Œï¼›å¦‚æœåœ¨è·¯å¾„ä¸­`\`åé¢å­˜åœ¨ä¸å¯è½¬ä¹‰çš„å­—ç¬¦ï¼Œè¿˜ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™å¤§é‡æŠ¥é”™ã€‚

***ç¬”è€…å·²å‘ä¸Šæ¸¸æäº¤[è¡¥ä¸](https://gitlab.gnome.org/GNOME/vala/-/commit/541e9f2c9dfde40b38fce32b8deb695f3eaf080b)ï¼Œè¯¥Bugäº`0.56.3`ä¿®å¤***

### å¤´æ–‡ä»¶åŒ…å«é—®é¢˜ï¼šGTypeçš„ä½¿ç”¨ä¸GLibçš„åŒ…å«ï¼ˆå·²ä¿®å¤ï¼‰

Valaé€šå¸¸éœ€è¦ä¾èµ–GLibä¸GObjectè¿›è¡Œä½¿ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•Valaæºä»£ç éƒ½çœ‹ä½œé»˜è®¤åŠ å…¥äº†ä¸€è¡Œ`using GLib`ï¼Œé»˜è®¤ä½¿ç”¨çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚ï¼š`int`, `uint`, `int64`, `uint64`, `char`, `double`ï¼‰éƒ½æ˜¯GLibä¸­å®šä¹‰çš„ï¼ˆå¯¹åº”ä¸Šæ–‡çš„ä¾‹å­ï¼Œå³`gint`, `guint`, `gint64`, `guint64`, `gchar`, `gdouble`ï¼‰ï¼Œé»˜è®¤åŒ…å«çš„å¤§é‡å†…ç½®å‡½æ•°ï¼ˆä¾‹å¦‚`print`, `get_real_time`ï¼‰ä¹Ÿæ¥è‡ªGLibï¼ˆä¸Šæ–‡ä¾‹å­å¯¹åº”çš„æ˜¯`g_print`, `g_get_real_time`ï¼‰ã€‚ç”šè‡³ï¼ŒValaä¸­çš„Boolå€¼ä¹Ÿæ¥è‡ªäºGLibä¸­å®çš„å®šä¹‰ã€‚

å¦å¤–ï¼ŒValaè¯­è¨€æœ¬èº«å¹¶æ²¡æœ‰`#include`è¯­å¥ï¼ŒValaåœ¨Cä»£ç å±‚é¢å¯¹å¤´æ–‡ä»¶çš„ä½¿ç”¨ç”±Valaç¼–è¯‘å™¨è‡ªåŠ¨å¤„ç†ã€‚è¿™å¯¼è‡´äº†æœ‰æ—¶å³ä½¿æ²¡æœ‰æ˜¾å¼ä½¿ç”¨GLibä¸­çš„å†…å®¹ï¼Œä¹Ÿå­˜åœ¨å¯¹GLibå¤´æ–‡ä»¶çš„ä¾èµ–ï¼Œå¦‚æœValaç¼–è¯‘å™¨æ²¡æœ‰åœ¨ç”Ÿæˆçš„Cä»£ç ä¸­è‡ªåŠ¨åŒ…å«æ‰€éœ€è¦çš„å¤´æ–‡ä»¶ï¼Œä¾¿ä¼šé€ æˆç¼–è¯‘é”™è¯¯ã€‚

ä¾‹å¦‚ï¼š
```vala
void main () {
    if (true) {
        stdout.printf ("test");
    }
}
```

å°†è¿™æ®µä»£ç ç¼–è¯‘ï¼Œæˆ–æˆäºˆUnixå¯æ‰§è¡Œæƒé™æ‰§è¡Œï¼Œä¼šæç¤ºä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼š
```bash
/tmp/temptest.vala.XXDIT1.c: In function '_vala_main':
/tmp/temptest.vala.XXDIT1.c:11:13: error: 'TRUE' undeclared (first use in this function)
   11 |         if (TRUE) {
      |             ^~~~
/tmp/temptest.vala.XXDIT1.c:11:13: note: each undeclared identifier is reported only once for each function it appears in
error: cc exited with status 256
Compilation failed: 1 error(s), 0 warning(s)
```

è¿˜æœ‰æ›´åŠ éšå¼çš„ä¾‹å­ï¼š
```vala
void main () {
    while (1 == 1) {
        stdout.printf ("test\n");
        break;
    }
}
```

åŒæ ·ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼š
```bash
/tmp/1.vala.c: In function '_vala_main':
/tmp/1.vala.c:11:16: error: 'TRUE' undeclared (first use in this function)
   11 |         while (TRUE) {
      |                ^~~~
/tmp/1.vala.c:11:16: note: each undeclared identifier is reported only once for each function it appears in
error: cc exited with status 1
Compilation failed: 1 error(s), 0 warning(s)
```

è¿™æ˜¯å› ä¸ºValaç”Ÿæˆä»£ç ä¸­çš„`TRUE`æ˜¯åœ¨GLibçš„å¤´æ–‡ä»¶ä¸­å®šä¹‰çš„ï¼Œè€Œè¿™æ®µç¨‹åºæ²¡æœ‰æ˜æ˜¾åœ°ä½¿ç”¨GLibçš„å†…å®¹ï¼ŒValaç¼–è¯‘å™¨å¹¶æ²¡æœ‰è‡ªåŠ¨åŒ…å«GLibçš„å¤´æ–‡ä»¶ï¼Œä½¿å¾—`TRUE`æœªå®šä¹‰ï¼Œé€ æˆç¼–è¯‘å¤±è´¥ã€‚

***ç¬”è€…å‘ä¸Šæ¸¸[åé¦ˆäº†è¿™ä¸€bug](https://gitlab.gnome.org/GNOME/vala/-/issues/1364)ï¼Œè¯¥bug[å·²äºç›®å‰çš„gitå­˜å‚¨åº“ä¸­ä¿®å¤](https://gitlab.gnome.org/GNOME/vala/-/commit/1560e367afc7d95ded40f1c67e559ac60c4c49cc)***

### å®¹å™¨ä¸­å¯¹è±¡çš„è¿ç®—ç¬¦é—®é¢˜ï¼š`a[i]+=1`ã€`a[i]=a[i]+1`ä¸`a[i]++`çš„å‘ï¼ˆå·²éƒ¨åˆ†ä¿®å¤ï¼‰

è¿™æ ·ä¸€æ®µç®€å•çš„æ•°å­—è®¡æ•°ç»Ÿè®¡ä»£ç å³å¯è¯•å‡ºè¿™ä¸€é—®é¢˜ï¼š
```vala
void main () {
    Intl.setlocale ();
    var nums = stdin.read_line ().split (" ");
    var dic = new Gee.HashMap<int64?, uint64?> ((Gee.HashDataFunc) int64_hash, (Gee.EqualDataFunc) int64_equal);
    foreach (var i in nums) {
        int64 num = int64.parse (i);
        if (num in dic.keys) {
            dic[num] = dic[num] + 1;
        } else {
            dic[num] = 1;
        }
    }
    foreach (var i in dic.values) {
        print (@"$i\n");
    }
}
```

ä»¥ä¸Šä»£ç å¯ä»¥æ­£å¸¸ç¼–è¯‘è¿è¡Œã€‚ä½†æ³¨æ„åˆ°è¯­å¥`dic[num] = dic[num] + 1`ï¼Œè‹¥å°†å…¶æ”¹ä¸º`dic[num]++`ï¼Œå°†ä¼šåœ¨ç¼–è¯‘æ—¶æŠ¥é”™ï¼š
```bash
error: The expression `Gee.HashMap<int64,uint64?>' does not denote an array
```

è€Œæ”¹æˆ`dic[num] += 1`åï¼Œè¯¥è¯­å¥çš„å®é™…æ•ˆæœå˜æˆäº†`dic[num] = 1`ï¼Œåœ¨ç¼–è¯‘æ—¶ä¼ é€’`-C`å‚æ•°ï¼Œæ£€æŸ¥Valaç¼–è¯‘å™¨ç”Ÿæˆçš„Cä»£ç ï¼Œå¯¹æ¯”æ­£å¸¸ç»“æœä¸å¼‚å¸¸ç»“æœå¯ä»¥å‘ç°ï¼Œæ”¹æˆ`dic[num] += 1`åï¼ŒValaæ˜¾ç„¶æ²¡æœ‰æ­£ç¡®å¤„ç†`+=`è¯­å¥ï¼š
```
 					GeeHashMap* _tmp18_;
-					guint64 _tmp19_;
+					GeeHashMap* _tmp19_;
+					gpointer _tmp20_;
+					guint64* _tmp21_;
+					guint64 _tmp22_;
 					_tmp18_ = dic;
-					_tmp19_ = (guint64) 1;
-					gee_abstract_map_set ((GeeAbstractMap*) _tmp18_, &num, &_tmp19_);
+					_tmp19_ = dic;
+					_tmp20_ = gee_abstract_map_get ((GeeAbstractMap*) _tmp19_, &num);
+					_tmp21_ = (guint64*) _tmp20_;
+					_tmp22_ = (*_tmp21_) + 1;
+					gee_abstract_map_set ((GeeAbstractMap*) _tmp18_, &num, &_tmp22_);
+					_g_free0 (_tmp21_);
```

å®Œæ•´diffå‚è§è¿™é‡Œï¼š[collectionBug.diff](https://gitlab.gnome.org/GNOME/vala/uploads/7ecfcb3276c99b8d45ffe85a3508432f/collectionBug.diff)

åœ¨ä½¿ç”¨é€šå¸¸çš„éå®¹å™¨ä¸­çš„å˜é‡æ—¶ï¼ŒValaç¼–è¯‘å™¨å‡èƒ½æ­£å¸¸å¤„ç†`+=`ä¸`++`æ“ä½œã€‚å¾ˆæ˜æ˜¾ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒValaç¼–è¯‘å™¨å¤„ç†å®¹å™¨ä¸­çš„å†…å®¹æ—¶å‡ºç°äº†Bugã€‚

***åœ¨æ­¤å¤„`map[i] += k`ä¸`map[i] = map[i] + k`è¡¨ç°ä¸åŒçš„é—®é¢˜å·²äºæœ€æ–°ç‰ˆå­˜å‚¨åº“ä¸­[ä¿®å¤](https://gitlab.gnome.org/GNOME/vala/-/commit/fa09ca11b9467614bdca514acbbbe3baddfd7dfa)***ã€‚æœ‰äº›å¯ç¬‘çš„æ˜¯ï¼Œè¿™ä¸€Bugåœ¨12å¹´å‰å°±æœ‰æ‰€æŠ¥é“ï¼Œåœ¨10å¹´å‰å°±æœ‰äº†ä¿®å¤è¡¥ä¸ï¼Œä½†ç›´åˆ°æœ€è¿‘æ‰å¾—åˆ°åˆå¹¶ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºå½“æ—¶Valaçš„ä¸»è¦ç»´æŠ¤è€…è¿˜æ˜¯Valaçš„åŸä½œè€…JÃ¼rg Billeterï¼Œä¸æ˜¯ç°åœ¨çš„Rico Tzschichholzï¼Œå¯èƒ½æ˜¯ç»´æŠ¤çš„äº¤æ¥å·¥ä½œä¸­æœ‰äº›ç–å¿½ã€‚

ç„¶è€Œï¼Œç›®å‰ä¸ºæ­¢ï¼Œå®¹å™¨ä¸­å¯¹è±¡ä¸èƒ½ä½¿ç”¨`a[i] ++`æˆ–è€…`++ a[i]`è¡¨è¾¾å¼çš„é—®é¢˜ä¾ç„¶æ²¡æœ‰å¾—åˆ°ä¿®å¤ã€‚

### ç±»å‹æ£€æŸ¥

Valaæ˜¯å¼ºç±»å‹è¯­è¨€ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿è¯ç±»å‹å®‰å…¨çš„åŒæ—¶ï¼Œå¾ˆå¤šæœ¬æ¥å®Œå…¨å¯ä»¥éšå¼è½¬åŒ–ç”šè‡³ç›´æ¥ç­‰ä»·çš„ç±»å‹å¹¶ä¸èƒ½éšå¼è½¬åŒ–ï¼Œå› æ­¤ä¹Ÿå¸¦æ¥äº†ä¸€äº›ä¸ä¾¿ã€‚ä¾‹å¦‚ï¼ŒValaä¸­é’ˆå¯¹GLibä¸­æ•°æ®ç»“æ„çš„`GLib.HashFunc`ä¸é’ˆå¯¹Geeä¸­æ•°æ®ç»“æ„çš„`Gee.HashDataFunc`åœ¨CåŸå› å‘¢ä»£ç å±‚é¢ä¸Šæ¥çœ‹æœ¬è´¨ä¸Šéƒ½æ˜¯`uint`ç±»å‹ï¼Œç„¶è€Œåœ¨Valaç¨‹åºä¸­ï¼Œè¦æ±‚ä¼ é€’ä¸€ä¸ª`Gee.HashDataFunc`å‡½æ•°ä½œä¸ºå‚æ•°çš„åœ°æ–¹å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨ä¸€ä¸ªç±»å‹ä¸º`HashFunc`çš„å‡½æ•°ï¼Œç”šè‡³ä¹Ÿä¸èƒ½ä½¿ç”¨ç±»å‹ä¸º`uint`çš„å‡½æ•°ï¼Œå¦‚æœè¦ä½¿ç”¨ï¼Œéœ€è¦åœ¨ä¼ å‚æ—¶æ˜¾å¼å¼ºåˆ¶ç±»å‹è½¬åŒ–ï¼Œè¿™æ ·çš„è§„å®šå¹¶æ²¡æœ‰æ„ä¹‰ï¼Œè¿˜ä¼šä¸ºç¼–ç¨‹å¸¦æ¥ä¸ä¾¿ã€‚

æ­¤å¤–ï¼ŒValaå¯¹éƒ¨åˆ†`nullable`ç±»å‹çš„é€‚é…ä¹Ÿå¹¶ä¸å……åˆ†ï¼Œå†…ç½®çš„å¤§é‡èƒ½å¤Ÿä¸º`int`ã€`uint`ã€`double`ç­‰è‡ªåŠ¨è·å–å†…ç½®hashã€equalã€cmpå‡½æ•°æ•°æ®ç»“æ„ä¸‹çš„æ–¹æ³•åœ¨é‡åˆ°`int?`ã€`uint?`ã€`double?`æ—¶é€šé€šå¤±çµï¼Œå› æ­¤å¯¹äº`nullable`ç±»å‹ï¼Œè¿™äº›å‡½æ•°è¿˜å¾€å¾€éœ€è¦æ‰‹åŠ¨ç¼–å†™æˆ–æŒ‡å®šï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚ç¬”è€…å¯¹è¯¥é—®é¢˜å·²ç»å‘Libgeeæäº¤äº†[ä¿®å¤è¡¥ä¸](https://gitlab.gnome.org/GNOME/libgee/-/merge_requests/10)ï¼Œä½†æ˜¯ç›®å‰ç»´æŠ¤è€…ä¼¼ä¹å¹¶æ²¡æœ‰åˆå¹¶çš„æ„å‘ã€‚

Valaåœ¨ä¸€äº›è¯¥è¿›è¡Œç±»å‹æ£€æŸ¥çš„å´åˆæ²¡æœ‰å¾ˆå¥½åœ°è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚å·§åˆçš„æ˜¯ï¼Œè¿™æ ·çš„Bugåˆæ˜¯ç¬”è€…åœ¨GLibçš„å®¹å™¨å¯¹è±¡ä¸­è§‚å¯Ÿåˆ°çš„ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºValaè¯­è¨€ä¸­çš„å¼€å‘ä¸»è¦ç”¨çš„æ˜¯Geeä¸­çš„å®¹å™¨å¯¹è±¡ï¼ŒGLibä¸­çš„å®¹å™¨ä½¿ç”¨è¾ƒå°‘ï¼Œè¾ƒæ˜“å­˜åœ¨Bugã€‚ä¾‹å¦‚ï¼š
```vala
#!/usr/bin/env -S vala -X -O2 -X -march=native -X -pipe
void main () {
    var dic = new HashTable<string, double> (str_hash, str_equal);
    dic["pi"] = 3.141592653589793;
    dic["e"] = 2.718281828459045;
    dic.foreach ((key, value) => {
        print (@"$key --> $value\n");
    });
}
```

è¿™é‡Œçš„æ³›å‹å‚æ•°`double`å¹¶ä¸å—æ”¯æŒï¼Œéœ€è¦ä½¿ç”¨`double?`ä»¤Valaæ­£ç¡®è‡ªåŠ¨å¤„ç†æŒ‡é’ˆã€‚ç„¶è€Œï¼ŒValaç¼–è¯‘å™¨å¹¶æ²¡æœ‰åœ¨æ­¤æŠ¥é”™ï¼ŒæŠ¥é”™å‘ç”Ÿåœ¨äº†Cè¯­è¨€çš„ç¼–è¯‘é˜¶æ®µï¼š
```
D:/17265/test.vala.c: In function '_vala_main':
D:/17265/test.vala.c:126:36: warning: passing argument 2 of 'g_hash_table_foreach' from incompatible pointer type [-Wincompatible-pointer-types]
  126 |         g_hash_table_foreach (dic, ___lambda4__gh_func, NULL);
      |                                    ^~~~~~~~~~~~~~~~~~~
      |                                    |
      |                                    void (*)(const void *, const void *, void *)
In file included from D:/msys64/ucrt64/include/glib-2.0/glib.h:52,
                 from D:/17265/test.vala.c:4:
D:/msys64/ucrt64/include/glib-2.0/glib/ghash.h:109:61: note: expected 'GHFunc' {aka 'void (*)(void *, void *, void *)'} but argument is of type 'void (*)(const void *, const void *, void *)'
  109 |                                             GHFunc          func,
      |
```

è€Œä½¿ç”¨`Gee.HashMap`æ—¶å°†ä¼šåœ¨Valaä»£ç å‘Cä»£ç ç¼–è¯‘çš„é˜¶æ®µæ­£å¸¸æŠ¥é”™ï¼š
```vala
#!/usr/bin/env -S vala --pkg=gee-0.8 -X -O2 -X -march=native -X -pipe
void main () {
    var dic = new Gee.HashMap<string, double> ();
    dic["pi"] = 3.141592653589793;
    dic["e"] = 2.718281828459045;
    foreach (var i in dic) {
        print (@"$(i.key) --> $(i.value)\n");
    }
}
```

```
gee-0.8.vapi:195.122-195.122: error: `double' is not a supported generic type argument, use `?' to box value types
  195 |         public abstract class AbstractMap<K,V> : GLib.Object, Gee.Traversable<Gee.Map.Entry<K,V>>, Gee.Iterable<Gee.Map.Entry<K,V>>, Gee.Map<K,V> {
      |                                                                                                                       
          ^
gee-0.8.vapi:195.122-195.122: error: `double' is not a supported generic type argument, use `?' to box value types
  195 |         public abstract class AbstractMap<K,V> : GLib.Object, Gee.Traversable<Gee.Map.Entry<K,V>>, Gee.Iterable<Gee.Map.Entry<K,V>>, Gee.Map<K,V> {
      |                                                                                                                       
          ^
Compilation failed: 2 error(s), 0 warning(s)
```

### ï¼ˆä¸ªäººä¹ æƒ¯é—®é¢˜ï¼‰ä»C#å¼•å…¥çš„â€œä¸èƒ½ä½¿ç”¨å…¶ä»–æ•°æ®ç±»å‹ä»£æ›¿Boolâ€çš„åˆç†æ€§

Cã€C++ã€Pythonç­‰å¤§å¤šæ•°çš„è¯­è¨€ä¸€èˆ¬éƒ½ä¼šæ”¯æŒç”¨0ä¸é0ï¼ˆæˆ–è€…ç©ºä¸éç©ºï¼‰åˆ†åˆ«è¡¨ç¤ºBoolå€¼çš„å‡ä¸çœŸã€‚ç„¶è€Œï¼ŒC#è¯­è¨€å› ä¸ºæ‹…å¿ƒè¿™å¯èƒ½ä¼šå®¹æ˜“ä½¿ç¨‹åºå‘˜çŠ¯æŸäº›é”™è¯¯ï¼ˆå¦‚èµ‹å€¼`=`ä¸ç­‰äº`==`ææ··ï¼‰ï¼Œåœ¨æ¡ä»¶åˆ¤æ–­ä¸­åªæ”¯æŒä½¿ç”¨æ˜¾å¼çš„Boolå€¼æˆ–Boolæ¡ä»¶è¡¨è¾¾å¼ã€‚è¯­æ³•é«˜åº¦ä¸C#ç›¸ä¼¼çš„Valaä¹Ÿä»C#é‚£é‡Œç»§æ‰¿æ¥äº†è¿™ä¸ªç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œ`if (object) {}`åœ¨Cè¯­è¨€æˆ–è€…C++ä¸­æ˜¯æ­£ç¡®çš„ï¼Œåœ¨Valaä¸­å´ä¸è¡Œï¼Œéœ€è¦æ”¹æˆ`if (object != 0) {}`æˆ–è€…`if (object != null)`ã€‚å¯¹ç¬”è€…ä¸ªäººè€Œè¨€ï¼Œè¿™æ ·çš„è®¾è®¡å¸¦æ¥äº†ä¸ä¾¿ã€‚

### LSPçš„ç¨³å®šæ€§

Valaçš„LSPè™½ç„¶åŠŸèƒ½å¼ºå¤§ä¸°å¯Œï¼Œæ”¯æŒä»¥vscodeæ’ä»¶çš„å½¢å¼éå¸¸æ–¹ä¾¿åœ°è°ƒç”¨ï¼Œä½†ç›®å‰ç¨³å®šæ€§å¹¶ä¸ç†æƒ³ï¼Œå°¤å…¶æ˜¯åœ¨Windowså¹³å°ä¸‹å´©æºƒæå…¶é¢‘ç¹ï¼Œç”šè‡³åˆ°äº†éš¾ä»¥ä½¿ç”¨çš„åœ°æ­¥ã€‚

### é»˜è®¤æ—¶æ²¡æœ‰å……åˆ†ä½¿ç”¨å½©è‰²æŠ¥é”™

Valaçš„æŠ¥é”™æç¤ºåœ¨é»˜è®¤æƒ…å†µä¸‹é€šå¸¸ä¸æ˜¯å½©è‰²çš„ï¼Œéœ€è¦åœ¨ç¼–è¯‘æ—¶åŠ å…¥`--color=always`å‚æ•°æ‰èƒ½å¼€å¯å½©è‰²çš„æŠ¥é”™ã€‚

### å…¶ä»–é—®é¢˜ï¼šäº§ç”Ÿçš„Cä»£ç çš„æ•ˆç‡ä¸å¯è¯»æ€§

Valaç¼–è¯‘å™¨åœ¨å°†Valaæºä»£ç ç¼–è¯‘ä¸ºCæºä»£ç æ—¶ï¼Œä¼šäº§ç”Ÿå¾ˆå¤šå†—ä½™çš„`_tmpX_`å˜é‡ï¼Œä»¥åŠå¤šä½™çš„å˜é‡é—´èµ‹å€¼æ“ä½œï¼Œé€ æˆé¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚

æ­¤å¤–ç›®å‰Valaç¼–è¯‘å™¨ä¼¼ä¹æ˜¯ä¸ºäº†å…¼å®¹å¤è€çš„C89ï¼ŒæŸäº›ä»£ç ç”Ÿæˆå¾—ååˆ†å¤æ‚ï¼Œä¾‹å¦‚è¿™æ ·ä¸€ä¸ªç®€å•çš„å¾ªç¯ï¼š
```vala
void main () {
    for (var i=0;i<10;i+=1) {
        print ("%d/n", i);
    }
}
```

ç”±æ­¤ç¼–è¯‘å¾—åˆ°çš„Cä»£ç ä¸ºï¼š
```c
/* tmp.c generated by valac 0.56.3, the Vala compiler
 * generated from tmp.vala, do not modify */

#include <glib.h>

static void _vala_main (void);

static void
_vala_main (void)
{
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp0_ = FALSE;
			_tmp0_ = TRUE;
			while (TRUE) {
				if (!_tmp0_) {
					i += 1;
				}
				_tmp0_ = FALSE;
				if (!(i < 10)) {
					break;
				}
				g_print ("%d/n", i);
			}
		}
	}
}

int
main (int argc,
      char ** argv)
{
	_vala_main ();
	return 0;
}
```

å¯è§ï¼ŒValaè¯­è¨€å°†è¿™ä¸ªåœ¨C99åŠä»¥åçš„Cè¯­è¨€æ ‡å‡†ä¸­éƒ½è¯­æ³•æ­£ç¡®çš„forå¾ªç¯è½¬åŒ–æˆäº†ä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„whileå¾ªç¯ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯`while (TRUE)`å’Œ`if (!condition) {break;}`çš„ç»“æ„ã€‚Valaç¼–è¯‘å™¨è¿˜å°†`i+=1`ç¼–è¯‘åˆ°äº†ä¸€ä¸ªæ¡ä»¶åˆ¤æ–­å†…ï¼Œä»¥ä¾¿æ§åˆ¶åœ¨é¦–æ¬¡å¾ªç¯æ—¶ä¸æ‰§è¡Œ`i+=1`ã€‚è¿™äº›éƒ½ä½¿å¾—Valaç”Ÿæˆçš„Cä»£ç è¾ƒä¸ºå†—é•¿ï¼Œå¯è¯»æ€§è¾ƒä½ã€‚

## ç›®å‰çš„å‘å±•

è™½ç„¶Valaè¯­è¨€å·²ç»è¯ç”Ÿäº†åå¤šå¹´ï¼Œä½†å…¶ä»åœ¨åœ¨ç§¯æçš„å‘å±•ä¸­ï¼Œä¸æ–­æœ‰æ–°åŠŸèƒ½å¼•å…¥ã€‚åœ¨ä»Šå¹´çš„å¤§ç‰ˆæœ¬æ›´æ–°ä¸­ï¼ŒValaä¹ŸåŠ å…¥äº†å¤§é‡çš„ã€å®ç”¨çš„æ–°åŠŸèƒ½ï¼Œä»¥ä¸‹æ˜¯éƒ¨åˆ†æ–°åŠŸèƒ½ä¸¾ä¾‹ï¼š

è‡ª`0.56.0`èµ·ï¼ŒValaæ”¯æŒäº†åœ¨ä¸€ä¸ªå‡½æ•°å†…éƒ¨å£°æ˜åµŒå¥—å‡½æ•°ï¼š
```vala
void write_streams (OutputStream stream1, OutputStream stream2, uint8[] data) {
    void nested_function (Object object_source, AsyncResult result) {
        OutputStream stream = object_source as OutputStream;
        try {
            ssize_t size = stream.write_async.finish (result);
            stdout.printf (@"Written $size bytes\n");
        } catch (Error e) {
            stderr.printf ("Error writing to stream: %s", e.message);
        }
    }

    stream1.write_async (data, nested_function);
    stream2.write_async (data, nested_function);
}
```

è¿™æ ·çš„åµŒå¥—å‡½æ•°åªåœ¨å±€éƒ¨æœ‰æ•ˆï¼Œä¸`lambda`å‡½æ•°ç±»ä¼¼ï¼ŒåµŒå¥—å‡½æ•°å¯ä»¥è®¿é—®ä¸Šå±‚å‡½æ•°ä¸­çš„å˜é‡ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åœ¨å…¶æœ‰æ•ˆèŒƒå›´å†…å¤šæ¬¡è°ƒç”¨ï¼Œå¼¥è¡¥äº†`lambda`å‡½æ•°ä¸€èˆ¬åªèƒ½â€œä¸€æ¬¡æ€§ä½¿ç”¨â€çš„ä¸è¶³ã€‚

è‡ª`0.56.0`èµ·ï¼ŒValaè¿˜å¼•å…¥äº†éƒ¨åˆ†ç±»çš„åŠŸèƒ½ï¼Œå¯ä»¥å°†ä¸€ä¸ª`class`åˆ†ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œç”šè‡³æ”¾åˆ°å¤šä¸ªæ–‡ä»¶ä¸­è¿›è¡Œå£°æ˜ï¼Œåªéœ€è¦åœ¨å£°æ˜æ—¶åŠ å…¥`partial`å…³é”®å­—ï¼š
```vala
public partial class Foo : Object {
    public double bar { get; set; }
}

public partial class Foo : Initable {
    public virtual bool init (Cancellable? cancellable = null) {
        stdout.printf ("hello!\n");
        this.bar = 0.56;
        return true;
    }
}
```

åœ¨`0.56.0`ä¸­ï¼ŒValaè¿˜ä¸º`Sequence`å’Œ`Array`æ•°æ®ç»“æ„å¢åŠ äº†`foreach`çš„æ”¯æŒï¼Œå¯¹ä½¿ç”¨è¿™äº›æ•°æ®ç»“æ„çš„äººå¸¦æ¥äº†æ›´å¤šçš„ä¾¿åˆ©ã€‚

è€Œåœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¸­ï¼ŒValaè¿˜è®¡åˆ’ä¸º[ISO 646](http://www.cplusplus.com/reference/ciso646/)æä¾›æ”¯æŒï¼Œä»è¯­æ³•ä¸Šå¸¦æ¥æ›´å¥½çš„ä½“éªŒã€‚

ç”±æ­¤å¯è§ï¼Œç›´åˆ°ç°åœ¨ï¼ŒValaä»ç„¶ä¼šç§¯æåœ°åŠ å…¥æ–°åŠŸèƒ½ï¼Œä¿æŒè¿™é—¨ç°ä»£è¯­è¨€çš„å…ˆè¿›æ€§ã€‚

Valaçš„ç»´æŠ¤ç¤¾åŒºè™½ç„¶å‚ä¸äººæ•°ä¸åŠä¼—å¤šçƒ­é—¨è¯­è¨€ï¼Œä½†Valaç¤¾åŒºä»è¾ƒä¸ºæ´»è·ƒï¼Œæ¢è®¨æ°›å›´è‰¯å¥½ã€‚ä»ä¸Šæ–‡[æœ‰å…³ç¼–è¯‘å™¨bugçš„éƒ¨åˆ†å†…å®¹](/2022/10/17/æ¢ç´¢Valaè¯­è¨€/#å¤´æ–‡ä»¶åŒ…å«é—®é¢˜gtypeçš„ä½¿ç”¨ä¸glibçš„åŒ…å«å·²ä¿®å¤)å¯ä»¥å‘ç°ï¼Œåœ¨ç¬”è€…æ’°å†™è¿™ç¯‡åšå®¢çš„çŸ­çŸ­çš„æ—¶é—´é‡Œï¼Œå°±æœ‰bugä»åé¦ˆåˆ°å®Œæˆäº†ä¿®å¤çš„è¿‡ç¨‹ï¼Œè€Œè¿™ä¹Ÿè¦å½’åŠŸäºç¤¾åŒºçš„ç§¯æç›¸åº”ã€‚è¿™æ ·è‰¯å¥½çš„ç¤¾åŒºç¯å¢ƒä¹Ÿè¿›ä¸€æ­¥ç¡®ä¿äº†Valaè¯­è¨€ä¸ä¼šè½ä¼ã€‚

## æˆ‘çš„è´¡çŒ®

Valaç¼–è¯‘å™¨æ˜¯æºåˆ°æºç¼–è¯‘å™¨ï¼Œç¼–è¯‘å™¨ç”Ÿæˆçš„IRå°±æ˜¯Cè¯­è¨€çš„æ­£å¸¸ä»£ç ï¼Œå¯è¯»æ€§è¾ƒä¸€èˆ¬IRå¼ºï¼›åŒæ—¶ï¼ŒValaç¼–è¯‘å™¨ç»“æ„è¾ƒä¸ºç®€å•ï¼Œæ˜“äºç»´æŠ¤ã€‚ç¬”è€…è™½ç„¶æŠ€æœ¯æ°´å¹³è¾ƒä½ï¼Œå¯¹Valaä¹Ÿè¿˜æ²¡æœ‰åšåˆ°å®Œå…¨äº†è§£ï¼Œä½†ä¹Ÿèƒ½å‚ä¸åˆ°Valaç¼–è¯‘å™¨çš„ç»´æŠ¤å·¥ä½œä¸­ã€‚

### é€å­—å­—ç¬¦ä¸²æ¨¡æ¿

ç¬”è€…ä¸ºValaä¸‹ä¸€ä¸ªç‰ˆæœ¬æä¾›çš„[é€å­—å­—ç¬¦ä¸²æ¨¡æ¿åŠŸèƒ½](https://gitlab.gnome.org/GNOME/vala/-/merge_requests/266)å·²ç»å¾—åˆ°åˆå¹¶ï¼Œè¯¥åŠŸèƒ½æ”¯æŒå°†Valaçš„é€å­—å­—ç¬¦ä¸²ä¸æ¨¡æ¿å­—ç¬¦ä¸²ç»“åˆä½¿ç”¨ï¼Œå…¶å…³ç³»ç±»ä¼¼äºPythonçš„`rf""`ä¹‹äº`r""`å’Œ`f""`ï¼Œè¿›ä¸€æ­¥å¢å¼ºäº†Valaçš„å­—ç¬¦ä¸²å¤„ç†åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å°†ä¸¤è€…åŠŸèƒ½ç»“åˆï¼Œåœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­å°†`\`è§†ä¸º`\`å­—ç¬¦æœ¬èº«ï¼Œè€Œéè½¬ä¹‰å­—ç¬¦ï¼Œä¾‹å¦‚è¿™æ ·çš„è¡¨è¾¾ï¼š
```vala
void main () {
    double pi = 3.141592653589;
    var s = @"""\pi/ \wow/ \$pi/""";
    print (s);
    // Output:
    // \pi/ \wow/ \3.141592653589/
}
```

### äºŒè¿›åˆ¶`0b`ä¸å…«è¿›åˆ¶`0o`æ•´æ•°è¡¨è¾¾å¼ï¼ˆå¾…åˆå¹¶ï¼‰

ç¬”è€…ä¸ºValaæä¾›äº†å¯¹ä»¥`0b`å¼€å¤´çš„äºŒè¿›åˆ¶æ•´æ•°è¡¨è¾¾å¼ï¼Œä»¥åŠä»¥`0o`å¼€å¤´çš„å…«è¿›åˆ¶æ•´æ•°è¡¨è¾¾å¼çš„æ”¯æŒã€‚è¯¥åŠŸèƒ½å·²ç»æäº¤äº†[PR](https://gitlab.gnome.org/GNOME/vala/-/merge_requests/273)ï¼Œä½†ç›®å‰å°šæœªåˆå¹¶ã€‚è¿™æ”¯æŒäº†ä»¥ä¸‹å†™æ³•ï¼š

```vala
var a = 0b10101010101;
var b = 0o1234567; // The same as `01234567` but clearer
var c = 0o644u;
var d = -0o755ll;
```

å…¶ä¸­ï¼ŒäºŒè¿›åˆ¶æ•´æ•°è¡¨è¾¾å¼ä¸ºæ–°å¢å†™æ³•ï¼Œè€Œä»¥`0o`å¼€å¤´çš„å…«è¿›åˆ¶æ•´æ•°è¡¨è¾¾å¼çš„å¯è¯»æ€§è¾ƒåŸæ¥ä»¥å•ä¸ª`0`å¼€å¤´çš„å…«è¿›åˆ¶è¡¨è¾¾å¼å¯è¯»æ€§æ›´å¥½ã€‚

### ç”¨ä¸‹åˆ’çº¿ä½œæ•°å­—åˆ†éš”ç¬¦çš„æ”¯æŒï¼ˆå¾…åˆå¹¶ï¼‰

ç¬”è€…ç»™Valaå¢åŠ æ”¯æŒç”¨ä¸‹åˆ’çº¿åˆ†éš”æ•°å­—ä»¥å¢å¼ºå¯è¯»æ€§çš„åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å·²ç»[æäº¤PR](https://gitlab.gnome.org/GNOME/vala/-/merge_requests/263)ï¼Œç­‰å¾…å®˜æ–¹çš„å®¡æ ¸ä¸åˆå¹¶ã€‚è¯¥åŠŸèƒ½å¢åŠ äº†å¯¹ä»¥ä¸‹å†™æ³•çš„æ”¯æŒï¼š
```vala
int a = 123_456_789;
uint b = 1_000_0000;
double c = 1_500.200_2e-1_000;
```

ä½†ç”±äºä¹‹å‰Valaéœ€è¦æ”¯æŒå½¢å¦‚`123_456`çš„å˜é‡åï¼Œå› æ­¤è¿™ä¸€åŠŸèƒ½è‡³å°‘ä¸èƒ½å¾ˆå¿«è¢«åˆå¹¶ã€‚ç¬”è€…ä¸ºæ­¤è¿˜æäº¤äº†[å¦ä¸€ä¸ªPR](https://gitlab.gnome.org/GNOME/vala/-/merge_requests/270)ï¼Œé€šè¿‡å¼•å…¥ç¼–è¯‘æ—¶è­¦å‘Šæ¥é€æ­¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚

ç„¶è€Œï¼Œç›®å‰å°±[è®¨è®ºè¶‹åŠ¿](https://gitlab.gnome.org/GNOME/vala/-/merge_requests/263#note_1598114)æ¥çœ‹ï¼ŒValaç¤¾åŒºæ›´å€¾å‘äºä½¿ç”¨C23æ ‡å‡†çš„`'`è€Œä¸æ˜¯Pythonã€JSã€C#é‡‡ç”¨çš„`_`ä½œä¸ºåˆ†éš”ç¬¦ã€‚ç¬”è€…ä¸ªäººè®¤ä¸ºä½¿ç”¨`'`åˆ†éš”çš„ä»£ç å¯è¯»æ€§æ›´å·®ï¼Œä½†æ˜¯è¿™ä¸€æ–¹æ¡ˆä¸ä¼šç ´åValaå˜é‡å‘½åçš„å…¼å®¹æ€§ã€‚æ•°å­—åˆ†éš”ç¬¦çš„å…·ä½“é‡‡ç”¨æ–¹æ¡ˆå¯èƒ½éœ€è¦åç»­çš„è¿›ä¸€æ­¥è®¨è®ºã€‚

### Bugä¿®å¤åŠå…¶ä»–ä¿®æ”¹

ç¬”è€…ä¸ºValaä¿®å¤äº†(æˆ–ååŠ©Valaçš„å…¶ä»–ç»´æŠ¤è€…ä¸ºValaä¿®å¤äº†)ä¸‹åˆ—Bugï¼š

- [Windowsä¸‹è°ƒè¯•æ¨¡å¼çš„åæ–œæ ç¾éš¾](https://gitlab.gnome.org/GNOME/vala/-/commit/541e9f2c9dfde40b38fce32b8deb695f3eaf080b)
- [æ•´æ•°å¸¸é‡æº¢å‡ºæŠ¥é”™æç¤º](https://gitlab.gnome.org/GNOME/vala/-/merge_requests/273)
- [å…«è¿›åˆ¶æ•°è¡¨è¾¾å¼æœ‰æ•ˆæ€§æ£€æŸ¥](https://gitlab.gnome.org/GNOME/vala/-/merge_requests/273)
- [æµ®ç‚¹æ•°æŒ‡æ•°å½¢å¼ç¼ºå°‘æŒ‡æ•°éƒ¨åˆ†çš„æŠ¥é”™æç¤º](https://gitlab.gnome.org/GNOME/vala/-/merge_requests/264)

## ç¤ºä¾‹ï¼šWindowså¹³å°ä¸‹GTKç¨‹åºæ‰“åŒ…å™¨çš„å¼€å‘

ç”±äºWindowså¹³å°æ²¡æœ‰Linuxå¹³å°é‚£æ ·åŸºäºä¾èµ–å…³ç³»çš„åŒ…ç®¡ç†ä½“ç³»ï¼ŒWindowsä¹Ÿä¸ä¼šå¦‚å¤§å¤šæ•°Linuxå‘è¡Œç‰ˆä¸€æ ·é»˜è®¤é¢„è£…GTKï¼Œå› æ­¤Windowsä¸‹çš„GTKç¨‹åºåœ¨åˆ†å‘æ—¶è¿˜éœ€è¦å¯¹ä¾èµ–è¿›è¡Œæ‰“åŒ…ã€‚è€Œè¯¥æ‰“åŒ…æµç¨‹ä¸€èˆ¬è¾ƒä¸ºå¤æ‚ã€‚å› æ­¤ï¼Œç¬”è€…æ‰“ç®—å¼€å‘ä¸€ä¸ªé€‚ç”¨äºMSYS2ç¯å¢ƒçš„Windowså¹³å°GTKç¨‹åºæ‰“åŒ…å™¨ã€‚ç¬”è€…å¸Œæœ›å®ç°ä¸€ä¸ªå…·æœ‰GUIçš„ç¨‹åºï¼Œè¯¥ç¨‹åºè‡ªèº«çš„GUIå³å¯ä½¿ç”¨GTKå®ç°ã€‚

### åç«¯

è¯¥æ‰“åŒ…å™¨çš„åç«¯ä¸»è¦åŠŸèƒ½ä¸ºè§£æäºŒè¿›åˆ¶ä¾èµ–ä»¥åŠå¤åˆ¶åŒ…æ‹¬ç¨‹åºåŠå…¶äºŒè¿›åˆ¶ä¾èµ–åœ¨å†…çš„æ›´å¤šæ–‡ä»¶ã€‚è§£æäºŒè¿›åˆ¶ä¾èµ–çš„å·¥ä½œå¯ä»¥äº¤ç»™`ntldd`å®Œæˆã€‚å½“è§£æåˆ°çš„äºŒè¿›åˆ¶ä¾èµ–æ–‡ä»¶ä½äºMSYS2ç›®å½•ä¸‹æ—¶ï¼Œæ„å‘³ç€è¿™ä¸€æ–‡ä»¶éœ€è¦æ‰“åŒ…ï¼Œè€ŒMSYS2ç›®å½•çš„è·å–ä¸è§£æå·¥ä½œå‡å¯ä»¥ä½¿ç”¨ä¸Valaé›†æˆè‰¯å¥½çš„æ­£åˆ™è¡¨è¾¾å¼æ¥å®Œæˆã€‚æ­¤å¤–ï¼Œä¸€èˆ¬GTKç¨‹åºä¾èµ–çš„ç»˜åˆ¶åº“ã€ä¸»é¢˜åº“ä¹Ÿå¾€å¾€éœ€è¦å¤åˆ¶ã€‚

ç”±æ­¤æ€è·¯ï¼Œå¯ä»¥å®ç°ä»¥ä¸‹ä¸å®Œå–„çš„åç«¯ä»£ç ï¼š

```vala
namespace GtkPacker {
    public class Packer : Object {
        public string file_path;
        public string outdir;
        string mingw_path = null;
        static Regex quote_regex {get; default = /(".*")|('.*')/;}
        static Regex msys2_dep_regex {get; default = /.*(\/|\\)(usr|ucrt64|clang64|mingw64|mingw32|clang32|clangarm64)(\/|\\)/;}
        Gee.HashSet<string> dependencies = new Gee.HashSet<string> ();
    
        public Packer (string file_path, string outdir) {
            this.file_path = clean_path (file_path);
            this.outdir = clean_path (outdir);
        }
    
        static inline string clean_path (string path) {
            return (quote_regex.match (path)) ? path[1:path.length-1] : path;
        }
    
        void copy_bin_files () {
            string deps_info;
    
            Process.spawn_command_line_sync (@"ntldd -R '$(this.file_path)'", out deps_info);
            var bin_path = Path.build_path (Path.DIR_SEPARATOR_S, this.outdir, "bin");
            DirUtils.create_with_parents (bin_path, 644);
            
            var file = File.new_for_path (this.file_path);
            var target = File.new_for_path (Path.build_path (Path.DIR_SEPARATOR_S, bin_path, file.get_basename ()));
            file.copy (target, FileCopyFlags.OVERWRITE);
            
            var deps_info_array = deps_info.split ("\n");
            foreach (var i in deps_info_array) {
                var j = i.strip ();
                var item = j.split (" ");
                if ((item.length == 4) && (!(item[0] in this.dependencies))) {
                    bool condition;
                    if (this.mingw_path == null) {
                        MatchInfo match_info;
                        condition = msys2_dep_regex.match (item[2], 0, out match_info);
                        this.mingw_path = match_info.fetch (0);
                    } else {
                        condition = msys2_dep_regex.match (item[2]);
                    }
                    if (condition) {
                        this.dependencies.add (item[0]);
                        file = File.new_for_path (item[2]);
                        target = File.new_for_path (Path.build_path(Path.DIR_SEPARATOR_S, bin_path, item[0]));
                        file.copy (target, FileCopyFlags.OVERWRITE);
                    }
                }
            }
        }
    
        static bool copy_recursive (File src, File dest, FileCopyFlags flags = FileCopyFlags.NONE, Cancellable? cancellable = null) throws Error {
            FileType src_type = src.query_file_type (FileQueryInfoFlags.NONE, cancellable);
            if ( src_type == FileType.DIRECTORY ) {
                string src_path = src.get_path ();
                string dest_path = dest.get_path ();
                DirUtils.create_with_parents(dest_path, 644);
                src.copy_attributes (dest, flags, cancellable);
            
                FileEnumerator enumerator = src.enumerate_children (FileAttribute.STANDARD_NAME, FileQueryInfoFlags.NONE, cancellable);
                for ( FileInfo? info = enumerator.next_file (cancellable) ; info != null ; info = enumerator.next_file (cancellable) ) {
                    copy_recursive (
                    File.new_for_path (Path.build_filename (src_path, info.get_name ())),
                    File.new_for_path (Path.build_filename (dest_path, info.get_name ())),
                    flags,
                    cancellable);
                }
            } else if ( src_type == FileType.REGULAR ) {
                src.copy (dest, flags, cancellable);
            }
          
            return true;
        }
    
        void copy_resources() {
            string[] resources = {
                Path.build_path (Path.DIR_SEPARATOR_S, "share", "themes", "default", "gtk-3.0"),
                Path.build_path (Path.DIR_SEPARATOR_S, "share", "themes", "emacs", "gtk-3.0"),
                Path.build_path (Path.DIR_SEPARATOR_S, "share", "glib-2.0", "schemas"),
                Path.build_path (Path.DIR_SEPARATOR_S, "share", "icons"),
                Path.build_path (Path.DIR_SEPARATOR_S, "lib", "gdk-pixbuf-2.0")
            };
    
            if ("libgtk-3-0.dll" in this.dependencies || "libgtk-4-1.dll" in this.dependencies) {
                foreach (var item in resources) {
                    var resource = File.new_for_path (Path.build_path(Path.DIR_SEPARATOR_S, this.mingw_path, item));
                    var target = File.new_for_path (Path.build_path(Path.DIR_SEPARATOR_S, this.outdir, item));
                    copy_recursive (resource, target, FileCopyFlags.OVERWRITE);
                }
            }
        }
    
        public void run () {
            this.copy_bin_files ();
            this.copy_resources ();
        }
    }    
}
```

ç¬”è€…è®¡åˆ’ç”¨GTK4å®ç°å…¶å‰ç«¯ï¼Œä½†å…·ä½“å·¥ä½œå°šæœªå®Œæˆã€‚å¾…å®Œæˆåï¼Œä¼šå°†ä»£ç å’Œä¸»è¦æ€è·¯è¡¥å……åˆ°è¿™é‡Œã€‚

## æèµ 

|  **æ”¯ä»˜å®**  |  **å¾®ä¿¡æ”¯ä»˜**  |
|  :----:  |  :----:  |
|  [![](/img/donate-alipay.webp)](/img/donate-alipay.webp)  |  [![](/img/donate-wechatpay.webp)](/img/donate-wechatpay.webp)  |
