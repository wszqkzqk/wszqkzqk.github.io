---
layout:     post
title:      在Manjaro下配置人脸识别
subtitle:   Howdy安装及配置过程
date:       2021-08-17
author:     星外之神
header-img: /img/howdy-bg.jpg
catalog:    true
tags:       Linux manjaro KDE 系统配置
---

<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=435305771&auto=1&height=66"></iframe>

# 本博客页面还未完成，正在持续更新中～

## 我在Manjro上配置人脸识别的缘由
我的系统登录密码设置得太长了，而且各种字母数字特殊符号，输入起来很麻烦  
想到Windows系统下有Windows Hello™，由此，我决定用人脸识别来解决这个问题  
就是找Linux下Windows Hello™的替代品（  
## 过程
我的设备是联想小新Pro16集显版，系统环境是manjaro-KDE  
![](/img/manjaro-screenfetch.png)  
由于硬件太新，主线内核中没有我的无线网卡（RTL8852AE）的驱动，这台电脑又没有网线接口，我只能临时将手机通过USB连接的方式共享网络给电脑，安装好对应版本的linux-header后，在AUR中下载编译对应的网卡驱动，解决了网卡驱动问题  
![](/img/RTW8852AE-driver.png)  
不知道主线内核什么时候跟进，现在这个驱动稳定性实在是太菜了……

能够顺利联网以后，再来考虑人脸识别的问题

事实上，Linux下的确有一个与Windows Hello™类似的人脸识别系统——[Howdy](https://github.com/boltgolt/howdy)  
这个项目在GitHub上已经拥有2800+颗星（截至2021.08.17）  
![](/img/howdy.png)  

### 下载、编译、安装
该软件在[GitHub上的页面](https://github.com/boltgolt/howdy)已经对其安装过程有所介绍

manjaro是基于Arch开发的衍生发行版，所以可以参考[Arch wiki](https://wiki.archlinux.org/title/Howdy_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87))上的相关内容

理论上可以直接在manjaro自带的软件管理器Pamac上直接搜索并安装howdy,然而由于howdy的源代码存储在GitHub上，在大陆访问网络并不通畅，很可能会出现下载失败的情况，所以这里我建议中国大陆的Linuxer采用另外的方法：

先在工作目录打开终端，执行

``` shell
git clone https://aur.archlinux.org/pam-python.git
```
``` shell
git clone https://aur.archlinux.org/python-dlib.git
```
``` shell
git clone https://aur.archlinux.org/python-face_recognition_models.git
```
``` shell
git clone https://aur.archlinux.org/python-face_recognition.git
```
``` shell
git clone https://aur.archlinux.org/howdy.git
```

![](/img/aur-git-clone.png)

然后再在各个软件的AUR页面中分别找到主要的源文件的地址（编译时能够直接下载成功的就不用找了，无须每个都找），用GitHub文件下载神器——[Free Download Manager](https://www.freedownloadmanager.org/)下载（[FDM的AUR在这里](http://aur.archlinux.org/packages/freedownloadmanager)）
![](/img/FDM-download.png)

下载完成后，把各个软件包所需的文件分别移动到各个已经从AUR上clone下来的文件夹中（注意：有些文件在FDM中下载的名称与pkgbuild中的不同，需要重命名）  

在各个文件夹中执行

``` shell
makepkg -si
```

注意要按照顺序：pam-python、python-dlib、python-face_recognition_models、python-face_recognition、howdy,否则将会提示无法满足依赖
![](/img/makepkg.png)
安装过程到此结束
### 配置
在Arch wiki上已有howdy的[配置教程](https://wiki.archlinux.org/title/Howdy_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87))，但是按照其方法进行配置后在KDE上仍然不能使用人脸识别登录，在此，我给出一个更完善的方法：

#### 红外发射装置的启动（如果不需要或设备不支持红外发射可跳过此过程）
首先，对于支持红外发射的电脑，建议还是要开启红外发射功能提高识别的准确度（而且红外发射式还支持全黑暗状态下的人脸识别）

若需启用红外发射，需要安装[linux-enable-ir-emitter](https://github.com/EmixamPP/linux-enable-ir-emitter)

``` shell
git clone https://aur.archlinux.org/linux-enable-ir-emitter.git
cd linux-enable-ir-emitter
makepkg -si
```
如果出现下载失败的情况，按照上一章的方法下载即可  
安装完成后，执行如下命令：
``` shell
sudo linux-enable-ir-emitter quick
sudo linux-enable-ir-emitter boot enable
```
仅需按照终端中的提示完成该过程，即实现了红外的启用

#### PAM配置
要启用人脸验证功能，需要在`/etc/pam.d/`目录下的部分文件插入：
> auth sufficient pam_python.so /lib/security/howdy/pam.py

将以上代码插入到所需要改动的文件的**第二行**，**切勿插入至第一行，切勿删除或改动文件的其他内容**

一般而言，需要插入的文件如下，可按具体需要进行调整
- login、system-local-login、sddm（如果使用的是lighdm或者gdm则是其对应的文件）、kde（如果使用的是其他桌面环境也可类比） 
- sudo、polkit-1 在用户授权中启用人脸识别验证
































# 免责声明
本博客仅为方法分享，不承担任何责任，按照本博客内容操作所产生的各种风险均由操作者自行承担

欢迎大家在评论区留言！

本文采用[署名-非商业性使用-相同方式共享 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)协议发布，未经本人许可，**禁止用于商业用途**，非商业转载时请**对本文原作者进行署名**，基于本文的衍生作品需要按照[相同方式共享](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)