---
layout:     post
title:      探索Vala语言
subtitle:   Vala语言学习心得
date:       2022-??-??
author:     星外之神
header-img: img/Vala_Logo.webp
catalog:    true
tags:       GTK Vala 开源软件
---

***未经特殊说明，本文中的所有代码均采用[LGPL v2.1+](https://www.gnu.org/licenses/old-licenses/lgpl-2.1.en.html)协议公开***

## 简介

Vala语言是一门专门为GObject对象设计的编程语言，语法类似于C#。Vala并没有自己的运行时，而是依靠在编译时由Vala编译器将Vala源代码转化为C源代码，并在此过程中由C语言的基本特性实现lambda、class等各种高级功能，通常来说，基础的Vala程序的依赖仅有GLib和系统的C语言库，十分小巧精炼。Vala具有自动的内存管理功能，它在编译时进行引用计数，生成的C代码与手动管理内存的C代码结构上类似，避免了引入GC或进行运行时引用计数检查对程序效率的额外开销。因此，Vala同时拥有C#的高开发效率与C的高效低内存占用。

此外，Vala语言与C#语言一样，还具有跨平台的特性。Vala背靠完备的基础库GLib、强大的图形库GTK，以及各种各样的语言绑定，既能用来开发高效率运行的CLI应用，又能用来开发功能丰富的GUI应用，适用场景较广。

## 语言特点与代码风格

Vala语言

## 优势

## 不足

自Vala语言于2006年推出到现在，始终没有能够发布正式版。该语言虽然开发高效，使用便捷，但是使用人数与开发人数都远远小于主流大众语言。因此，尤其是在一些不太常用的地方，Vala可能会存在一定的编译器Bug。而这些编译器Bug在开发过程中往往难以定位，降低开发效率。Vala语言主要是为了GObject开发，而GObject在Linux下的应用远远多于在Windows下的应用，所以Vala对Windows平台下的开发体验可能顾及较少。

笔者在这里对自己在学习Vala过程中遇到的编译器Bug（或反人类之处、不合理之处）予以列举。

### 反斜杠灾难：Windows下的编译器Bug

***笔者已向上游提交补丁，该Bug于`0.56.3`修复***

Vala程序支持使用GDB等工具进行调试（需要在编译时向`valac`编译器传递`-g`参数）。Vala编译器依靠在生成的C源代码中插入`#line`语句来加入程序中对应的源代码文件的路径以及行数等调试信息。

然而，在笔者将这一Bug修复前，Vala会将编译参数中的文件路径未加处理即写入到生成的C源代码中。对于Linux等类Unix平台，文件路径的分隔符为`/`，一般不会出现问题。但是Windows平台的文件路径分隔符为`\`，C源代码字符串中的`\`将会被识别为转义字符，这会导致`#line`语句中的源代码文件路径错误，使得调试无法进行；如果在路径中`\`后面存在不可转义的字符，还会在编译的时候大量报错。

### 头文件包含问题：GType的使用与GLib的包含

### 容器中对象的运算符问题：`a[i]+=1`、`a[i]=a[i]+1`与`a[i]++`的坑

### 其他问题：产生的C代码的效率问题

## 发展

Vala仍在在积极的发展中，不断有新功能引入。

## 示例
